$(document).ready(function(){"use strict";var a=$('[name="selected-language"]').val(),b=window.location.pathname,c={en:{NAME_MIN:"Must have at least 3 characters",NAME_MAX:"Can have at most 50 characters",USERNAME_MIN:"Must have at least 3 characters",USERNAME_MAX:"Can have at most 50 characters",EMAIL:"This is not a valid email address",EMAIL_MAX:"Can have at most 50 characters",PASSWORD_MIN:"Must have at least 6 characters",BIOGRAPHY_MAX:"Can have at most 500 characters",TITLE_MAX:"Can have at most 500 characters",DESCRIPTION_MAX:"Can have at most 500 characters",EMPTY:"This field is required",CHECKED:"This field is required",UNWATCH:"Unwatch",WATCH:"Watch",UNSTAR:"Unstar",STAR:"Star",MATCH:"This field must match the field above",AVATAR_FORMAT:"Unfortunately, we only support PNG, GIF, or JPG pictures",AVATAR_SIZE:"Unfortunately, we only support pictures with up to 1 MB size",ADD_AVATAR:"Upload new picture",TOO_WEAK:"Too Weak",WEAK:"Weak",GOOD:"Good",STRONG:"Strong",DELETE_MODAL_MESSAGE:"Are you ABSOLUTELY sure?\nIf so, please type in the title of the tale to confirm.",DELETE_MODAL_WRONG_TITLE:"Wrong tale title"},pt:{NAME_MIN:"Deve conter ao menos 3 caracteres",NAME_MAX:"Pode conter no máximo 50 caracters",USERNAME_MIN:"Deve conter ao menos 3 caracteres",USERNAME_MAX:"Pode conter no máximo 50 caracters",EMAIL:"Este não é um email válido",EMAIL_MAX:"Pode conter no máximo 50 caracters",PASSWORD_MIN:"Deve conter ao menos 6 caracteres",BIOGRAPHY_MAX:"Pode conter no máximo 500 caracteres",TITLE_MAX:"Pode conter no máximo 500 caracteres",DESCRIPTION_MAX:"Pode conter no máximo 500 caracteres",EMPTY:"Este campo é obrigatório",CHECKED:"Este campo é obrigatório",UNWATCH:"Parar de Seguir",WATCH:"Seguir",UNSTAR:"Tirar Recomendação",STAR:"Recomendar",MATCH:"Este campo deve ser igual ao de cima",AVATAR_FORMAT:"Infelizmente, suportamos apenas imagens em PGN, GIF ou JPG",AVATAR_SIZE:"Infelizmente, suportamos apenas imagens com tamanho de até 1 MB",ADD_AVATAR:"Enviar nova imagem",TOO_WEAK:"Muito fraca",WEAK:"Fraca",GOOD:"Boa",STRONG:"Forte",DELETE_MODAL_MESSAGE:"Você tem certeza ABSOLUTA?\nSe sim, por favor digite o título do conto para confirmar.",DELETE_MODAL_WRONG_TITLE:"Título do conto errado"}},d={name:[{type:"length[3]",prompt:c[a].NAME_MIN},{type:"maxLength[50]",prompt:c[a].NAME_MAX}],username:[{type:"length[3]",prompt:c[a].USERNAME_MIN},{type:"maxLength[50]",prompt:c[a].USERNAME_MAX}],email:[{type:"email",prompt:c[a].EMAIL},{type:"maxLength[50]",prompt:c[a].EMAIL_MAX}],password:[{type:"length[6]",prompt:c[a].PASSWORD_MIN}],biography:[{type:"maxLength[500]",prompt:c[a].BIOGRAPHY_MAX}],title:[{type:"empty",prompt:c[a].EMPTY},{type:"maxLength[500]",prompt:c[a].TITLE_MAX}],description:[{type:"maxLength[500]",prompt:c[a].DESCRIPTION_MAX}],empty:[{type:"empty",prompt:c[a].EMPTY}],checked:[{type:"checked",prompt:c[a].CHECKED}],match:function(b){return[{type:"match["+b+"]",prompt:c[a].MATCH}]}},e=function(a){if(a.length<6)return 0;if(a.length<8)return 1;var b=0;return/[a-z]/.test(a)&&++b,/[A-Z]/.test(a)&&++b,/[0-9]/.test(a)&&++b,/[@#$%&\*\(\)!\-\+]/.test(a)&&++b,1==b?1:2==b?2:3},f=function(a,b,c){var d='<ul class="ui negative message" id="messages-list">';c&&(d='<ul class="ui positive message" id="messages-list">');for(var e=a.length-1;e>=0;e--)d+="<li>"+a[e]+"</li>";d+="</ul>",$("#messages-list").remove(),b.after(d)};if("/"===b){var g=$("#top-all"),h=$("#top-today"),i=$(".top-tales");g.on("click",function(a){h.removeClass("active"),g.addClass("active"),$.ajax({type:"get",url:"/get_ten_best_tales",data:{timezone_offset:(new Date).getTimezoneOffset()},datatype:"json",success:function(a){i.find("div").remove(),i.append(a)},error:function(a,b,c){console.log(a)}})}),h.on("click",function(a){g.removeClass("active"),h.addClass("active"),$.ajax({type:"get",url:"/get_ten_best_daily_tales",data:{timezone_offset:(new Date).getTimezoneOffset()},datatype:"json",success:function(a){i.find("div").remove(),i.append(a)},error:function(a,b,c){console.log(a)}})}),h.trigger("click")}if(-1!==b.indexOf("join")){var j=$(".login"),k=$(".signup"),l=k.find(".password-strength");k.find('input[name="signup-password"]').on("keyup",function(b){var d=this.value,f=e(d);switch(l.removeClass(),f){case 0:l.addClass("ui yellow label").html(c[a].TOO_WEAK);break;case 1:l.addClass("ui green label").html(c[a].WEAK);break;case 2:l.addClass("ui blue label").html(c[a].GOOD);break;default:l.addClass("ui red label").html(c[a].STRONG)}}),j.find("form").form({username:{identifier:"login-username",rules:d.username},password:{identifier:"login-password",rules:d.password}},{inline:!0,onSuccess:function(){var a=$(this).find('input[type="password"]')[0],b=a.value,c=new jsSHA(b,"TEXT").getHash("SHA-256","HEX");return a.value=c,$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,b,c){f(a.responseJSON.error_list,j.find("h2"))}}),!1}}),k.find("form").form({username:{identifier:"signup-username",rules:d.username},email:{identifier:"signup-email",rules:d.email},password:{identifier:"signup-password",rules:d.password},repeat_password:{identifier:"signup-repeat-password",rules:d.match("signup-password")}},{inline:!0,onSuccess:function(){var a=$(this).find('input[name="signup-password"]')[0],b=a.value,c=new jsSHA(b,"TEXT").getHash("SHA-256","HEX");a.value=c;var d=$(this).find('input[name="signup-repeat-password"]')[0];return b=d.value,c=new jsSHA(b,"TEXT").getHash("SHA-256","HEX"),d.value=c,$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){f([a.message],k.find("h2"),!0)},error:function(a,b,c){f(a.responseJSON.error_list,k.find("h2"))}}),!1}})}if(-1!==b.indexOf("password_reset")){var m=$(".password-reset form");m.form({email:{identifier:"password-reset-email",rules:d.email}},{inline:!0,onSuccess:function(){return $.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){f([a.message],m.find("h1"),!0)},error:function(a,b,c){f(a.responseJSON.error_list,m.find("h1"))}}),!1}})}if(-1!==b.indexOf("change_password")){var n=$(".change-password form");n.form({password:{identifier:"change-password-new-password",rules:d.password},repeat_password:{identifier:"change-password-confirm-new-password",rules:d.password}},{inline:!0,onSuccess:function(){var a=$(this).find('input[name="change-password-new-password"]')[0],b=a.value,c=new jsSHA(b,"TEXT").getHash("SHA-256","HEX");a.value=c;var d=$(this).find('input[name="change-password-confirm-new-password"]')[0];return b=d.value,c=new jsSHA(b,"TEXT").getHash("SHA-256","HEX"),d.value=c,$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,b,c){f(a.responseJSON.error_list,n.find("h1"))}}),!1}})}if(-1!==b.indexOf("profile")){var o=/profile\/([^\/]+)/.exec(b)[1],p=$(".own"),q=$(".participated"),r=function(a,b){a=parseInt(a,10),$.ajax({type:"get",url:"/get_rendered_own_tales",datatype:"json",data:{username:o,offset:a,search_string:b},success:function(b){var c=p.find("table");c.removeClass("loading form"),c.find("tbody").empty().append(b.template);var d=p.find("#previous-button"),e=p.find("#next-button");d.val(b.previous_offset),e.val(b.next_offset),parseInt(b.previous_offset,10)===a?d.addClass("disabled"):d.removeClass("disabled"),parseInt(b.next_offset,10)===a?e.addClass("disabled"):e.removeClass("disabled")},error:function(a,b,c){console.log(a)}})},s=function(a,b){a=parseInt(a,10),$.ajax({type:"get",url:"/get_rendered_participated_tales",datatype:"json",data:{username:o,offset:a,search_string:b},success:function(b){var c=q.find("table");c.removeClass("loading form"),c.find("tbody").empty().append(b.template);var d=q.find("#previous-button"),e=q.find("#next-button");d.val(b.previous_offset),e.val(b.next_offset),parseInt(b.previous_offset,10)===a?d.addClass("disabled"):d.removeClass("disabled"),parseInt(b.next_offset,10)===a?e.addClass("disabled"):e.removeClass("disabled")},error:function(a,b,c){console.log(a)}})};p.on("click",".own-pagination",function(a){return a.preventDefault(),r(this.value,p.find("input").val()),!1}),q.on("click",".participated-pagination",function(a){return a.preventDefault(),s(this.value,q.find("input").val()),!1}),r(0),s(0),p.on("submit","form",function(a){return a.preventDefault(),r(0,$(this).find("input").val()),!1}),q.on("submit","form",function(a){return a.preventDefault(),s(0,$(this).find("input").val()),!1})}if(-1!==b.indexOf("update/")){var t=$(".profile"),u=$(".button-update-profile");t.on("change",'input[name="update-avatar"]',function(b){var d=this.files[0];if(d){var e=t.find(".button-choose-file"),f=t.find(".label-choose-file");/\.(jpe?g|png|gif)$/i.test(d.name)?d.size<1048576?(e.addClass("green").html(d.name),f.removeClass("ui red label").html("")):(this.value="",this.files=[],e.removeClass("green").html(c[a].ADD_AVATAR),f.addClass("ui red label").html(c[a].AVATAR_SIZE)):(this.value="",this.files=[],e.removeClass("green").html(c[a].ADD_AVATAR),f.addClass("ui red label").html(c[a].AVATAR_FORMAT))}}),t.on("click",".button-choose-file",function(a){return a.preventDefault(),t.find('input[name="update-avatar"]').trigger("click"),!1}),u.on("click",function(a){$.ajax({type:"get",url:"/get_user_info",datatype:"json",data:{user_id:this.value},success:function(a){t.find("form").remove(),t.append(a),t.find("form").form({name:{identifier:"update-name",rules:d.name},email:{identifier:"update-email",rules:d.email},email_visibility:{identifier:"update-email-visibility",rules:d.empty},biography:{identifier:"update-biography",rules:d.biography}},{inline:!0,onSuccess:function(){var a=t.find('button[name="update-profile-submit"]');return a.addClass("disabled loading"),$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(b,c,d){a.removeClass("disabled loading"),f(b.responseJSON.error_list,t.find("h4"))}}),!1},onFailure:function(){return!1}})},error:function(a,b,c){console.log(a)}})}),u.trigger("click"),$(".button-update-password").on("click",function(b){$.ajax({type:"get",url:"/get_update_password_form",datatype:"json",data:{user_id:this.value},success:function(b){t.find("form").remove(),t.append(b);var g=$(".password-strength");$('input[name="update-new-password"]').on("keyup",function(b){var d=this.value,f=e(d);switch(g.removeClass(),f){case 0:g.addClass("ui yellow label").html(c[a].TOO_WEAK);break;case 1:g.addClass("ui green label").html(c[a].WEAK);break;case 2:g.addClass("ui blue label").html(c[a].GOOD);break;default:g.addClass("ui red label").html(c[a].STRONG)}}),t.find("form").form({old_password:{identifier:"update-old-password",rules:d.password},new_password:{identifier:"update-new-password",rules:d.password},confirm_new_password:{identifier:"update-confirm-new-password",rules:d.match("update-new-password")}},{inline:!0,onSuccess:function(){var a=$(this).find('input[name="update-old-password"]')[0],b=a.value,c=new jsSHA(b,"TEXT").getHash("SHA-256","HEX");a.value=c;var d=$(this).find('input[name="update-new-password"]')[0];b=d.value,c=new jsSHA(b,"TEXT").getHash("SHA-256","HEX"),d.value=c;var e=$(this).find('input[name="update-confirm-new-password"]')[0];return b=e.value,c=new jsSHA(b,"TEXT").getHash("SHA-256","HEX"),e.value=c,$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,b,c){f(a.responseJSON.error_list,t.find("h4"))}}),!1},onFailure:function(){return!1}})},error:function(a,b,c){console.log(a)}})})}var v=$(".upper-bar");if(v.length>0){var w=$("#to-fullscreen"),x=$("#fullscreen");v.on("submit",".form-unfollow",function(b){b.preventDefault();var d=$(".form-unfollow"),e=d[0].action;return $.ajax({type:"post",url:e,datatype:"json",data:new FormData(this),processData:!1,contentType:!1,success:function(b){var f=d.find("button")[0];f.innerHTML='<i class="unhide icon"></i>'+c[a].WATCH+" "+b.followers,d.attr("action",e.replace("unfollow","follow")),d.attr("class","form-follow")},error:function(a,b,c){console.log(a)}}),!1}),v.on("submit",".form-follow",function(b){b.preventDefault();var d=$(".form-follow"),e=d[0].action;return $.ajax({type:"post",url:e,datatype:"json",data:new FormData(this),processData:!1,contentType:!1,success:function(b){if(b.error)window.location=b.error;else{var f=d.find("button")[0];f.innerHTML='<i class="unhide icon"></i>'+c[a].UNWATCH+" "+b.followers,d.attr("action",e.replace("follow","unfollow")),d.attr("class","form-unfollow")}},error:function(a,b,c){console.log(a)}}),!1}),v.on("submit",".form-unstar",function(b){b.preventDefault();var d=$(".form-unstar"),e=d[0].action;return $.ajax({type:"post",url:e,datatype:"json",data:new FormData(this),processData:!1,contentType:!1,success:function(b){var f=d.find("button")[0];f.innerHTML='<i class="star icon"></i>'+c[a].STAR+" "+b.stars,d.attr("action",e.replace("unstar","star")),d.attr("class","form-star")},error:function(a,b,c){console.log(a)}}),!1}),v.on("submit",".form-star",function(b){b.preventDefault();var d=$(".form-star"),e=d[0].action;return $.ajax({type:"post",url:e,datatype:"json",data:new FormData(this),processData:!1,contentType:!1,success:function(b){if(b.error)window.location=b.error;else{var f=d.find("button")[0];f.innerHTML='<i class="star icon"></i>'+c[a].UNSTAR+" "+b.stars,d.attr("action",e.replace("star","unstar")),d.attr("class","form-unstar")}},error:function(a,b,c){console.log(a)}}),!1}),-1!==b.indexOf("/fullscreen")&&x.modal("show"),w.on("click",function(a){x.modal("show")})}if(-1!==b.indexOf("update_tale")){var y=$(".main form");y.form({title:{identifier:"update-tale-title",rules:d.title},description:{identifier:"update-tale-description",rules:d.description},genres:{identifier:"update-tale-genres",rules:[{type:"empty_genres",prompt:c[a].EMPTY}]},license:{identifier:"update-tale-license",rules:d.checked},type:{identifier:"update-tale-type",rules:d.checked}},{rules:{empty_genres:function(){return $('[name="update-tale-genres"]')[0].children.length>0}},inline:!0,onSuccess:function(){return $.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,b,c){f(a.responseJSON.error_list,y.find("h1"))}}),!1}});var z=$("#genres"),A=$('select[name="update-tale-genres"]'),B=$('select[name="available-genres"]');$("#available-genres").on("keyup",function(a){for(var b=this.value,c=B[0],d=0;d<c.length;d++)c[d].innerHTML.indexOf(b)<0?$(c[d]).attr("hidden","true"):$(c[d]).removeAttr("hidden")}),$("#taken-genres").on("keyup",function(a){for(var b=this.value,c=A[0],d=0;d<c.length;d++)c[d].innerHTML.indexOf(b)<0?$(c[d]).attr("hidden","true"):$(c[d]).removeAttr("hidden")}),$("#add").on("click",function(a){for(var b=B.find("option:selected"),c=0;c<b.length;c++)A.append(b[c])}),$("#remove").on("click",function(a){for(var b=A.find("option:selected"),c=0;c<b.length;c++)B.append(b[c])}),z.on("dblclick",'select[name="update-tale-genres"] option',function(a){B.append(this),A.find("option").each(function(){$(this).attr("selected","selected")})}),z.on("dblclick",'select[name="available-genres"] option',function(a){A.append(this)})}if(-1!==b.indexOf("/search")&&($("#layout-search-bar").empty(),$('input[name="c"]').focus(),$("#sort-bar").on("change",function(a){window.location=window.location.href.replace(/\&?s=\d+\&?/,"")+"&s="+$(this).find("option:selected").val()})),-1!==b.indexOf("contribution_requests")){var C=$(".contribution-requests"),D=/contribution_requests\/([0-9]+)/.exec(window.location)[1],E=$(".o-c-r"),F=$(".c-c-r");E.on("click",function(a){1!==C.find(".open-contribution-requests").length&&(E.addClass("active"),F.removeClass("active"),$.ajax({type:"get",url:"/get_open_contribution_requests",datatype:"json",data:{tale_id:D},success:function(a){C.find(".closed-contribution-requests").remove(),C.append(a)},error:function(a,b,c){console.log(a)}}))}),E.trigger("click"),F.on("click",function(a){1!==C.find(".closed-contribution-requests").length&&(F.addClass("active"),E.removeClass("active"),$.ajax({type:"get",url:"/get_closed_contribution_requests",datatype:"json",data:{tale_id:D},success:function(a){C.find(".open-contribution-requests").remove(),C.append(a)},error:function(a,b,c){console.log(a)}}))})}if(-1!==b.indexOf("create")){var G=$(".create form");G.form({title:{identifier:"create-title",rules:d.title},description:{identifier:"create-description",rules:d.description},genres:{identifier:"create-genres",rules:[{type:"empty_genres",prompt:c[a].EMPTY}]},license:{identifier:"create-license",rules:d.checked},type:{identifier:"create-type",rules:d.checked}},{rules:{empty_genres:function(){return $('[name="create-genres"]')[0].children.length>0}},inline:!0,onSuccess:function(){return $.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,b,c){f(a.responseJSON.error_list,G.find("h1"))}}),!1}});var z=$("#genres"),H=$('select[name="create-genres"]'),B=$('select[name="available-genres"]');$("#available-genres").on("keyup",function(a){for(var b=this.value,c=B[0],d=0;d<c.length;d++)c[d].innerHTML.indexOf(b)<0?$(c[d]).attr("hidden","true"):$(c[d]).removeAttr("hidden")}),$("#taken-genres").on("keyup",function(a){for(var b=this.value,c=H[0],d=0;d<c.length;d++)c[d].innerHTML.indexOf(b)<0?$(c[d]).attr("hidden","true"):$(c[d]).removeAttr("hidden")}),$("#add").on("click",function(a){for(var b=B.find("option:selected"),c=0;c<b.length;c++)H.append(b[c])}),$("#remove").on("click",function(a){for(var b=H.find("option:selected"),c=0;c<b.length;c++)B.append(b[c])}),z.on("dblclick",'select[name="create-genres"] option',function(a){B.append(this),H.find("option").each(function(){$(this).attr("selected","selected")})}),z.on("dblclick",'select[name="available-genres"] option',function(a){H.append(this)})}if(-1!==b.indexOf("/contribute")){var I=$(".contribute-form");tinymce.init({selector:'textarea[name="contribute-content"]'}),I.form({title:{identifier:"contribute-title",rules:d.title}},{inline:!0,onSuccess:function(){var a=$('button[name="contribute-submit"]');return a.addClass("disabled loading"),$.ajax({type:this.method,url:this.action,data:{"contribute-title":I.find('[name="contribute-title"]').val(),"contribute-content":tinymce.get("contribute-content").getContent(),_csrf_token:I.find('[name="_csrf_token"]').val()},success:function(a){window.location=a.url},error:function(b,c,d){a.removeClass("disabled loading"),f(b.responseJSON.error_list,I.find("h1"))}}),!1}})}if(-1!==b.indexOf("settings")){var J=$("#form-delete");J.on("submit",function(b){b.preventDefault();var d=$(this).find("button").val(),e=prompt(c[a].DELETE_MODAL_MESSAGE);return e&&(e===d?$.ajax({type:this.method,url:this.action,datatype:"json",data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,b,c){console.log(a)}}):($(this).find("div").remove(),$(this).append('<div class="ui red message">'+c[a].DELETE_MODAL_WRONG_TITLE+"</div>"))),!1})}if(-1!==b.indexOf("contact")){var K=$(".contact-form");K.form({name:{identifier:"contact-name",rules:d.name},email:{identifier:"contact-email",rules:d.email},message:{identifier:"contact-message",rules:d.empty}},{inline:!0,onSuccess:function(){return $.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){var b=$("#received-message");b.html(a),b.addClass("ui positive message")},error:function(a,b,c){f(a.responseJSON.error_list,K.find("h1"))}}),!1}})}if(-1!==b.indexOf("/update_chapter")){var L=$(".update-chapter-form");tinymce.init({selector:'textarea[name="update-chapter-content"]'}),L.form({title:{identifier:"update-chapter-title",rules:d.title}},{inline:!0,onSuccess:function(){var a=$('button[name="update-chapter-submit"]');return a.addClass("disabled loading"),$.ajax({type:this.method,url:this.action,data:{"update-chapter-title":L.find('[name="update-chapter-title"]').val(),"update-chapter-content":tinymce.get("update-chapter-content").getContent(),_csrf_token:L.find('[name="_csrf_token"]').val()},success:function(a){window.location=a.url},error:function(b,c,d){a.removeClass("disabled loading"),f(b.responseJSON.error_list,L.find("h1"))}}),!1}})}}),function(a){function b(a,b,k){var l=0,m=[0],n="",o=null,n=k||"UTF8";if("UTF8"!==n&&"UTF16BE"!==n&&"UTF16LE"!==n)throw"encoding must be UTF8, UTF16BE, or UTF16LE";if("HEX"===b){if(0!==a.length%2)throw"srcString of HEX type must be in byte increments";o=d(a),l=o.binLen,m=o.value}else if("TEXT"===b)o=c(a,n),l=o.binLen,m=o.value;else if("B64"===b)o=f(a),l=o.binLen,m=o.value;else{if("BYTES"!==b)throw"inputFormat must be HEX, TEXT, B64, or BYTES";o=e(a),l=o.binLen,m=o.value}this.getHash=function(a,b,c,d){var e,f=null,k=m.slice(),n=l;if(3===arguments.length?"number"!=typeof c&&(d=c,c=1):2===arguments.length&&(c=1),c!==parseInt(c,10)||1>c)throw"numRounds must a integer >= 1";switch(b){case"HEX":f=g;break;case"B64":f=h;break;case"BYTES":f=i;break;default:throw"format must be HEX, B64, or BYTES"}if("SHA-224"===a)for(e=0;c>e;e+=1)k=u(k,n,a),n=224;else{if("SHA-256"!==a)throw"Chosen SHA variant is not supported";for(e=0;c>e;e+=1)k=u(k,n,a),n=256}return f(k,j(d))},this.getHMAC=function(a,b,k,o,p){var q,r,s,t,v=[],w=[];switch(q=null,o){case"HEX":o=g;break;case"B64":o=h;break;case"BYTES":o=i;break;default:throw"outputFormat must be HEX, B64, or BYTES"}if("SHA-224"===k)r=64,t=224;else{if("SHA-256"!==k)throw"Chosen SHA variant is not supported";r=64,t=256}if("HEX"===b)q=d(a),s=q.binLen,q=q.value;else if("TEXT"===b)q=c(a,n),s=q.binLen,q=q.value;else if("B64"===b)q=f(a),s=q.binLen,q=q.value;else{if("BYTES"!==b)throw"inputFormat must be HEX, TEXT, B64, or BYTES";q=e(a),s=q.binLen,q=q.value}if(a=8*r,b=r/4-1,s/8>r){for(q=u(q,s,k);q.length<=b;)q.push(0);q[b]&=4294967040}else if(r>s/8){for(;q.length<=b;)q.push(0);q[b]&=4294967040}for(r=0;b>=r;r+=1)v[r]=909522486^q[r],w[r]=1549556828^q[r];return k=u(w.concat(u(v.concat(m),a+l,k)),a+t,k),o(k,j(p))}}function c(a,b){var c,d,e,f,g=[],h=[],i=0;if("UTF8"===b)for(d=0;d<a.length;d+=1)for(c=a.charCodeAt(d),h=[],128>c?h.push(c):2048>c?(h.push(192|c>>>6),h.push(128|63&c)):55296>c||c>=57344?h.push(224|c>>>12,128|c>>>6&63,128|63&c):(d+=1,c=65536+((1023&c)<<10|1023&a.charCodeAt(d)),h.push(240|c>>>18,128|c>>>12&63,128|c>>>6&63,128|63&c)),e=0;e<h.length;e+=1){for(f=i>>>2;g.length<=f;)g.push(0);g[f]|=h[e]<<24-i%4*8,i+=1}else if("UTF16BE"===b||"UTF16LE"===b)for(d=0;d<a.length;d+=1){for(c=a.charCodeAt(d),"UTF16LE"===b&&(e=255&c,c=e<<8|c>>8),f=i>>>2;g.length<=f;)g.push(0);g[f]|=c<<16-i%4*8,i+=2}return{value:g,binLen:8*i}}function d(a){var b,c,d,e=[],f=a.length;if(0!==f%2)throw"String of HEX type must be in byte increments";for(b=0;f>b;b+=2){if(c=parseInt(a.substr(b,2),16),isNaN(c))throw"String of HEX type contains invalid characters";for(d=b>>>3;e.length<=d;)e.push(0);e[b>>>3]|=c<<24-b%8*4}return{value:e,binLen:4*f}}function e(a){var b,c,d,e=[];for(c=0;c<a.length;c+=1)b=a.charCodeAt(c),d=c>>>2,e.length<=d&&e.push(0),e[d]|=b<<24-c%4*8;return{value:e,binLen:8*a.length}}function f(a){var b,c,d,e,f,g=[],h=0;if(-1===a.search(/^[a-zA-Z0-9=+\/]+$/))throw"Invalid character in base-64 string";if(c=a.indexOf("="),a=a.replace(/\=/g,""),-1!==c&&c<a.length)throw"Invalid '=' found in base-64 string";for(c=0;c<a.length;c+=4){for(f=a.substr(c,4),d=e=0;d<f.length;d+=1)b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[d]),e|=b<<18-6*d;for(d=0;d<f.length-1;d+=1){for(b=h>>>2;g.length<=b;)g.push(0);g[b]|=(e>>>16-8*d&255)<<24-h%4*8,h+=1}}return{value:g,binLen:8*h}}function g(a,b){var c,d,e="",f=4*a.length;for(c=0;f>c;c+=1)d=a[c>>>2]>>>8*(3-c%4),e+="0123456789abcdef".charAt(d>>>4&15)+"0123456789abcdef".charAt(15&d);return b.outputUpper?e.toUpperCase():e}function h(a,b){var c,d,e,f="",g=4*a.length;for(c=0;g>c;c+=3)for(e=c+1>>>2,d=a.length<=e?0:a[e],e=c+2>>>2,e=a.length<=e?0:a[e],e=(a[c>>>2]>>>8*(3-c%4)&255)<<16|(d>>>8*(3-(c+1)%4)&255)<<8|e>>>8*(3-(c+2)%4)&255,d=0;4>d;d+=1)f=8*c+6*d<=32*a.length?f+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>>6*(3-d)&63):f+b.b64Pad;return f}function i(a){var b,c,d="",e=4*a.length;for(b=0;e>b;b+=1)c=a[b>>>2]>>>8*(3-b%4)&255,d+=String.fromCharCode(c);return d}function j(a){var b={outputUpper:!1,b64Pad:"="};try{a.hasOwnProperty("outputUpper")&&(b.outputUpper=a.outputUpper),a.hasOwnProperty("b64Pad")&&(b.b64Pad=a.b64Pad)}catch(c){}if("boolean"!=typeof b.outputUpper)throw"Invalid outputUpper formatting option";if("string"!=typeof b.b64Pad)throw"Invalid b64Pad formatting option";return b}function k(a,b){return a>>>b|a<<32-b}function l(a,b,c){return a&b^~a&c}function m(a,b,c){return a&b^a&c^b&c}function n(a){return k(a,2)^k(a,13)^k(a,22)}function o(a){return k(a,6)^k(a,11)^k(a,25)}function p(a){return k(a,7)^k(a,18)^a>>>3}function q(a){return k(a,17)^k(a,19)^a>>>10}function r(a,b){var c=(65535&a)+(65535&b);return((a>>>16)+(b>>>16)+(c>>>16)&65535)<<16|65535&c}function s(a,b,c,d){var e=(65535&a)+(65535&b)+(65535&c)+(65535&d);return((a>>>16)+(b>>>16)+(c>>>16)+(d>>>16)+(e>>>16)&65535)<<16|65535&e}function t(a,b,c,d,e){var f=(65535&a)+(65535&b)+(65535&c)+(65535&d)+(65535&e);return((a>>>16)+(b>>>16)+(c>>>16)+(d>>>16)+(e>>>16)+(f>>>16)&65535)<<16|65535&f}function u(a,b,c){var d,e,f,g,h,i,j,k,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M=[],N=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];if(v=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],e=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],"SHA-224"!==c&&"SHA-256"!==c)throw"Unexpected error in SHA-2 implementation";for(w=64,d=(b+65>>>9<<4)+15,z=16,A=1,K=Number,B=r,C=s,D=t,E=p,F=q,G=n,H=o,J=m,I=l,v="SHA-224"===c?v:e;a.length<=d;)a.push(0);for(a[b>>>5]|=128<<24-b%32,a[d]=b,L=a.length,x=0;L>x;x+=z){for(b=v[0],d=v[1],e=v[2],f=v[3],g=v[4],h=v[5],i=v[6],j=v[7],y=0;w>y;y+=1)16>y?(u=y*A+x,k=a.length<=u?0:a[u],u=a.length<=u+1?0:a[u+1],M[y]=new K(k,u)):M[y]=C(F(M[y-2]),M[y-7],E(M[y-15]),M[y-16]),k=D(j,H(g),I(g,h,i),N[y],M[y]),u=B(G(b),J(b,d,e)),j=i,i=h,h=g,g=B(f,k),f=e,e=d,d=b,b=B(k,u);v[0]=B(b,v[0]),v[1]=B(d,v[1]),v[2]=B(e,v[2]),v[3]=B(f,v[3]),v[4]=B(g,v[4]),v[5]=B(h,v[5]),v[6]=B(i,v[6]),v[7]=B(j,v[7])}if("SHA-224"===c)a=[v[0],v[1],v[2],v[3],v[4],v[5],v[6]];else{if("SHA-256"!==c)throw"Unexpected error in SHA-2 implementation";a=v}return a}"function"==typeof define&&define.amd?define(function(){return b}):"undefined"!=typeof exports?"undefined"!=typeof module&&module.exports?module.exports=exports=b:exports=b:a.jsSHA=b}(this);