$(document).ready(function(){var k=$("#selected-language")[0].innerHTML,p=window.location.pathname,m={en:{NAME_MIN:"Must have at least 3 characters",NAME_MAX:"Can have at most 50 characters",USERNAME_MIN:"Must have at least 3 characters",USERNAME_MAX:"Can have at most 50 characters",EMAIL:"This is not a valid email address",EMAIL_MAX:"Can have at most 50 characters",PASSWORD_MIN:"Must have at least 6 characters",BIOGRAPHY_MAX:"Can have at most 500 characters",TITLE_MAX:"Can have at most 500 characters",
DESCRIPTION_MAX:"Can have at most 500 characters",EMPTY:"This field is required",CHECKED:"This field is required",UNWATCH:"Unwatch",WATCH:"Watch",UNSTAR:"Unstar",STAR:"Star",MATCH:"This field must match the field above",AVATAR_FORMAT:"Unfortunately, we only support PNG, GIF, or JPG pictures",AVATAR_SIZE:"Unfortunately, we only support pictures with up to 1 MB size",ADD_AVATAR:"Upload new picture",TOO_WEAK:"Too Weak",WEAK:"Weak",GOOD:"Good",STRONG:"Strong",DELETE_MODAL_MESSAGE:"Are you ABSOLUTELY sure?\nIf so, please type in the title of the tale to confirm.",
DELETE_MODAL_WRONG_TITLE:"Wrong tale title"},pt:{NAME_MIN:"Deve conter ao menos 3 caracteres",NAME_MAX:"Pode conter no m\u00e1ximo 50 caracters",USERNAME_MIN:"Deve conter ao menos 3 caracteres",USERNAME_MAX:"Pode conter no m\u00e1ximo 50 caracters",EMAIL:"Este n\u00e3o \u00e9 um email v\u00e1lido",EMAIL_MAX:"Pode conter no m\u00e1ximo 50 caracters",PASSWORD_MIN:"Deve conter ao menos 6 caracteres",BIOGRAPHY_MAX:"Pode conter no m\u00e1ximo 500 caracteres",TITLE_MAX:"Pode conter no m\u00e1ximo 500 caracteres",
DESCRIPTION_MAX:"Pode conter no m\u00e1ximo 500 caracteres",EMPTY:"Este campo \u00e9 obrigat\u00f3rio",CHECKED:"Este campo \u00e9 obrigat\u00f3rio",UNWATCH:"Parar de Seguir",WATCH:"Seguir",UNSTAR:"Tirar Recomenda\u00e7\u00e3o",STAR:"Recomendar",MATCH:"Este campo deve ser igual ao de cima",AVATAR_FORMAT:"Infelizmente, suportamos apenas imagens em PGN, GIF ou JPG",AVATAR_SIZE:"Infelizmente, suportamos apenas imagens com tamanho de at\u00e9 1 MB",ADD_AVATAR:"Enviar nova imagem",TOO_WEAK:"Muito fraca",
WEAK:"Fraca",GOOD:"Boa",STRONG:"Forte",DELETE_MODAL_MESSAGE:"Voc\u00ea tem certeza ABSOLUTA?\nSe sim, por favor digite o t\u00edtulo do conto para confirmar.",DELETE_MODAL_WRONG_TITLE:"T\u00edtulo do conto errado"}},q={name:[{type:"length[3]",prompt:m[k].NAME_MIN},{type:"maxLength[50]",prompt:m[k].NAME_MAX}],username:[{type:"length[3]",prompt:m[k].USERNAME_MIN},{type:"maxLength[50]",prompt:m[k].USERNAME_MAX}],email:[{type:"email",prompt:m[k].EMAIL},{type:"maxLength[50]",prompt:m[k].EMAIL_MAX}],password:[{type:"length[6]",
prompt:m[k].PASSWORD_MIN}],biography:[{type:"maxLength[500]",prompt:m[k].BIOGRAPHY_MAX}],title:[{type:"empty",prompt:m[k].EMPTY},{type:"maxLength[500]",prompt:m[k].TITLE_MAX}],description:[{type:"maxLength[500]",prompt:m[k].DESCRIPTION_MAX}],empty:[{type:"empty",prompt:m[k].EMPTY}],checked:[{type:"checked",prompt:m[k].CHECKED}],match:function(a){return[{type:"match["+a+"]",prompt:m[k].MATCH}]}},C=function(a){if(6>a.length)return 0;if(8>a.length)return 1;var n=0;/[a-z]/.test(a)&&++n;/[A-Z]/.test(a)&&
++n;/[0-9]/.test(a)&&++n;/[@#$%&\*\(\)!\-\+]/.test(a)&&++n;return 1==n?1:2==n?2:3},x=function(a,n,v){var b='<ul class="ui negative message" id="messages-list">';v&&(b='<ul class="ui positive message" id="messages-list">');for(v=a.length-1;0<=v;v--)b+="<li>"+a[v]+"</li>";b+="</ul>";$("#messages-list").remove();n.after(b)};$("#language-en, #language-pt").on("click",function(a){a.preventDefault();a=/\-(\w+)/.exec(this.id)[1];$.ajax({type:"get",url:"/set_language",datatype:"json",data:{language:a},success:function(a){window.location.reload(!0)},
error:function(a,v,b){console.log(a)}});return!1});if("/"===p){var B=$("#top-all"),z=$("#top-today"),A=$(".top-tales");B.on("click",function(a){z.removeClass("active");B.addClass("active");$.ajax({type:"get",url:"/get_ten_best_tales",datatype:"json",success:function(a){A.find("div").remove();A.append(a)},error:function(a,v,b){console.log(a)}})});z.on("click",function(a){B.removeClass("active");z.addClass("active");$.ajax({type:"get",url:"/get_ten_best_daily_tales",datatype:"json",success:function(a){A.find("div").remove();
A.append(a)},error:function(a,b,c){console.log(a)}})});z.trigger("click")}if(-1!==p.indexOf("join")){var D=$(".login"),u=$(".signup"),G=u.find(".password-strength");u.find('input[name="signup-password"]').on("keyup",function(a){a=C(this.value);G.removeClass();switch(a){case 0:G.addClass("ui yellow label").html(m[k].TOO_WEAK);break;case 1:G.addClass("ui green label").html(m[k].WEAK);break;case 2:G.addClass("ui blue label").html(m[k].GOOD);break;default:G.addClass("ui red label").html(m[k].STRONG)}});
D.find("form").form({username:{identifier:"login-username",rules:q.username},password:{identifier:"login-password",rules:q.password}},{inline:!0,onSuccess:function(){var a=$(this).find('input[type="password"]')[0],n=(new jsSHA(a.value,"TEXT")).getHash("SHA-256","HEX");a.value=n;$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,n,b){x(a.responseJSON.error_list,D.find("h2"))}});return!1}});u.find("form").form({username:{identifier:"signup-username",
rules:q.username},email:{identifier:"signup-email",rules:q.email},password:{identifier:"signup-password",rules:q.password},repeat_password:{identifier:"signup-repeat-password",rules:q.match("signup-password")}},{inline:!0,onSuccess:function(){var a=$(this).find('input[name="signup-password"]')[0],n=a.value,n=(new jsSHA(n,"TEXT")).getHash("SHA-256","HEX");a.value=n;a=$(this).find('input[name="signup-repeat-password"]')[0];n=a.value;n=(new jsSHA(n,"TEXT")).getHash("SHA-256","HEX");a.value=n;$.ajax({type:this.method,
url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){x([a.message],u.find("h2"),!0)},error:function(a,n,b){x(a.responseJSON.error_list,u.find("h2"))}});return!1}})}if(-1!==p.indexOf("password_reset")){var J=$(".password-reset form");J.form({email:{identifier:"password-reset-email",rules:q.email}},{inline:!0,onSuccess:function(){$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){x([a.message],J.find("h1"),
!0)},error:function(a,n,b){x(a.responseJSON.error_list,J.find("h1"))}});return!1}})}if(-1!==p.indexOf("change_password")){var N=$(".change-password form");N.form({password:{identifier:"change-password-new-password",rules:q.password},repeat_password:{identifier:"change-password-confirm-new-password",rules:q.password}},{inline:!0,onSuccess:function(){var a=$(this).find('input[name="change-password-new-password"]')[0],n=a.value,n=(new jsSHA(n,"TEXT")).getHash("SHA-256","HEX");a.value=n;a=$(this).find('input[name="change-password-confirm-new-password"]')[0];
n=a.value;n=(new jsSHA(n,"TEXT")).getHash("SHA-256","HEX");a.value=n;$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,n,b){x(a.responseJSON.error_list,N.find("h1"))}});return!1}})}if(-1!==p.indexOf("profile")){var O=/profile\/([^\/]+)/.exec(p)[1],E=$(".own"),F=$(".participated"),K=function(a,n,b){$.ajax({type:"get",url:"/get_rendered_own_tales",datatype:"json",data:{username:O,offset:a,search_string:n},
success:function(n){E.empty().append(n);b||E.find("input")[0].focus();E.find("#pagination-buttons button").each(function(){parseInt(this.value,10)===parseInt(a,10)?$(this).addClass("disabled"):$(this).removeClass("disabled")})},error:function(a,n,b){console.log(a)}})},L=function(a,n,b){$.ajax({type:"get",url:"/get_rendered_participated_tales",datatype:"json",data:{username:O,offset:a,search_string:n},success:function(n){F.empty().append(n);b||F.find("input")[0].focus();F.find("#pagination-buttons button").each(function(){parseInt(this.value,
10)===parseInt(a,10)?$(this).addClass("disabled"):$(this).removeClass("disabled")})},error:function(a,n,b){console.log(a)}})};E.on("click",".own-pagination",function(a){a.preventDefault();K(this.value,E.find("input")[0].value);return!1});F.on("click",".participated-pagination",function(a){a.preventDefault();L(this.value,F.find("input")[0].value);return!1});K(0,"",!0);L(0,"",!0);E.on("submit","form",function(a){a.preventDefault();K(0,$(this).find("input")[0].value);return!1});F.on("submit","form",
function(a){a.preventDefault();L(0,$(this).find("input")[0].value);return!1})}var y=$(".profile");if(-1!==p.indexOf("update/")){var r=$(".button-update-profile");y.on("change",'input[name="update-avatar"]',function(a){if(a=this.files[0]){var n=y.find(".button-choose-file"),b=y.find(".label-choose-file");/\.(jpe?g|png|gif)$/i.test(a.name)?1048576>a.size?(n.addClass("green").html(a.name),b.removeClass("ui red label").html("")):(this.value="",this.files=[],n.removeClass("green").html(m[k].ADD_AVATAR),
b.addClass("ui red label").html(m[k].AVATAR_SIZE)):(this.value="",this.files=[],n.removeClass("green").html(m[k].ADD_AVATAR),b.addClass("ui red label").html(m[k].AVATAR_FORMAT))}});y.on("click",".button-choose-file",function(a){a.preventDefault();y.find('input[name="update-avatar"]').trigger("click");return!1});r.on("click",function(a){$.ajax({type:"get",url:"/get_user_info",datatype:"json",data:{user_id:this.value},success:function(a){y.find("form").remove();y.append(a);y.find("form").form({name:{identifier:"update-name",
rules:q.name},email:{identifier:"update-email",rules:q.email},email_visibility:{identifier:"update-email-visibility",rules:q.empty},biography:{identifier:"update-biography",rules:q.biography}},{inline:!0,onSuccess:function(){$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,n,b){x(a.responseJSON.error_list,y.find("h4"))}});return!1},onFailure:function(){return!1}})},error:function(a,b,c){console.log(a)}})});
r.trigger("click");$(".button-update-password").on("click",function(a){$.ajax({type:"get",url:"/get_update_password_form",datatype:"json",data:{user_id:this.value},success:function(a){y.find("form").remove();y.append(a);var b=$(".password-strength");$('input[name="update-new-password"]').on("keyup",function(a){a=C(this.value);b.removeClass();switch(a){case 0:b.addClass("ui yellow label").html(m[k].TOO_WEAK);break;case 1:b.addClass("ui green label").html(m[k].WEAK);break;case 2:b.addClass("ui blue label").html(m[k].GOOD);
break;default:b.addClass("ui red label").html(m[k].STRONG)}});y.find("form").form({old_password:{identifier:"update-old-password",rules:q.password},new_password:{identifier:"update-new-password",rules:q.password},confirm_new_password:{identifier:"update-confirm-new-password",rules:q.match("update-new-password")}},{inline:!0,onSuccess:function(){var a=$(this).find('input[name="update-old-password"]')[0],b=a.value,b=(new jsSHA(b,"TEXT")).getHash("SHA-256","HEX");a.value=b;a=$(this).find('input[name="update-new-password"]')[0];
b=a.value;b=(new jsSHA(b,"TEXT")).getHash("SHA-256","HEX");a.value=b;a=$(this).find('input[name="update-confirm-new-password"]')[0];b=a.value;b=(new jsSHA(b,"TEXT")).getHash("SHA-256","HEX");a.value=b;$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,b,n){x(a.responseJSON.error_list,y.find("h4"))}});return!1},onFailure:function(){return!1}})},error:function(a,b,c){console.log(a)}})})}r=$(".upper-bar");
if(0<r.length){var b=$("#to-fullscreen"),d=$("#fullscreen"),h=$("#change-chapter");r.on("submit",".form-unfollow",function(a){a.preventDefault();var b=$(".form-unfollow"),c=b[0].action;$.ajax({type:"post",url:c,datatype:"json",data:new FormData(this),processData:!1,contentType:!1,success:function(a){b.find("button")[0].innerHTML='<i class="unhide icon"></i>'+m[k].WATCH+" "+a.followers;b.attr("action",c.replace("unfollow","follow"));b.attr("class","form-follow column")},error:function(a,b,n){console.log(a)}});
return!1});r.on("submit",".form-follow",function(a){a.preventDefault();var b=$(".form-follow"),c=b[0].action;$.ajax({type:"post",url:c,datatype:"json",data:new FormData(this),processData:!1,contentType:!1,success:function(a){a.error?window.location=a.error:(b.find("button")[0].innerHTML='<i class="unhide icon"></i>'+m[k].UNWATCH+" "+a.followers,b.attr("action",c.replace("follow","unfollow")),b.attr("class","form-unfollow column"))},error:function(a,b,n){console.log(a)}});return!1});r.on("submit",
".form-unstar",function(a){a.preventDefault();var b=$(".form-unstar"),c=b[0].action;$.ajax({type:"post",url:c,datatype:"json",data:new FormData(this),processData:!1,contentType:!1,success:function(a){b.find("button")[0].innerHTML='<i class="star icon"></i>'+m[k].STAR+" "+a.stars;b.attr("action",c.replace("unstar","star"));b.attr("class","form-star column")},error:function(a,b,n){console.log(a)}});return!1});r.on("submit",".form-star",function(a){a.preventDefault();var b=$(".form-star"),c=b[0].action;
$.ajax({type:"post",url:c,datatype:"json",data:new FormData(this),processData:!1,contentType:!1,success:function(a){a.error?window.location=a.error:(b.find("button")[0].innerHTML='<i class="star icon"></i>'+m[k].UNSTAR+" "+a.stars,b.attr("action",c.replace("star","unstar")),b.attr("class","form-unstar column"))},error:function(a,b,n){console.log(a)}});return!1});-1!==p.indexOf("/fullscreen")&&d.modal("show");b.on("click",function(a){d.modal("show")});h.on("click",function(a){a.preventDefault();window.location=
this.href+"/fullscreen";return!1})}if(-1!==p.indexOf("update_tale")){var c=$(".main form");c.form({title:{identifier:"update-tale-title",rules:q.title},description:{identifier:"update-tale-description",rules:q.description},genres:{identifier:"update-tale-genres",rules:[{type:"empty_genres",prompt:m[k].EMPTY}]},license:{identifier:"update-tale-license",rules:q.checked},type:{identifier:"update-tale-type",rules:q.checked}},{rules:{empty_genres:function(){return 0<$('[name="update-tale-genres"]')[0].children.length}},
inline:!0,onSuccess:function(){$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,b,e){x(a.responseJSON.error_list,c.find("h1"))}});return!1}});var r=$("#genres"),e=$('select[name="update-tale-genres"]'),g=$('select[name="available-genres"]');$("#available-genres").on("keyup",function(a){a=this.value;for(var b=g[0],c=0;c<b.length;c++)0>b[c].innerHTML.indexOf(a)?$(b[c]).attr("hidden","true"):$(b[c]).removeAttr("hidden")});
$("#taken-genres").on("keyup",function(a){a=this.value;for(var b=e[0],c=0;c<b.length;c++)0>b[c].innerHTML.indexOf(a)?$(b[c]).attr("hidden","true"):$(b[c]).removeAttr("hidden")});$("#add").on("click",function(a){a=g.find("option:selected");for(var b=0;b<a.length;b++)e.append(a[b])});$("#remove").on("click",function(a){a=e.find("option:selected");for(var b=0;b<a.length;b++)g.append(a[b])});r.on("dblclick",'select[name="update-tale-genres"] option',function(a){g.append(this);e.find("option").each(function(){$(this).attr("selected",
"selected")})});r.on("dblclick",'select[name="available-genres"] option',function(a){e.append(this)})}$(".results");if(-1!==p.indexOf("search")){$("#layout-search-bar").empty();$('input[name="content"]').focus();var l=$(".main-block"),Q=1;$.ajax({type:"get",url:"/search_tales"+window.location.search,datatype:"json",success:function(a){l.empty().append(a)},error:function(a,b,c){console.log(a)}});var R=function(a,b){$.ajax({type:"get",url:a,datatype:"json",data:{"sort-value":b},success:function(b){l.empty().append(b);
Q=a.indexOf("tales")},error:function(a,b,c){console.log(a)}})};$(".search-block").on("click",".search-tales, .search-users",function(a){a.preventDefault();R(this.href,1);return!1});l.on("change","#sort-bar",function(a){a="";a=0<=Q?$(".search-tales")[0].href:$(".search-users")[0].href;R(a,$(this).find("option:selected")[0].value)})}var I=$(".contribution-requests");if(-1!==p.indexOf("contribution_requests")){var S=/contribution_requests\/([0-9]+)/.exec(window.location)[1],P=$(".o-c-r"),f=$(".c-c-r");
P.on("click",function(a){1!==I.find(".open-contribution-requests").length&&(console.log("HERE"),P.addClass("active"),f.removeClass("active"),$.ajax({type:"get",url:"/get_open_contribution_requests",datatype:"json",data:{tale_id:S},success:function(a){I.find(".closed-contribution-requests").remove();I.append(a)},error:function(a,b,c){console.log(a)}}))});P.trigger("click");f.on("click",function(a){1!==I.find(".closed-contribution-requests").length&&(f.addClass("active"),P.removeClass("active"),$.ajax({type:"get",
url:"/get_closed_contribution_requests",datatype:"json",data:{tale_id:S},success:function(a){I.find(".open-contribution-requests").remove();I.append(a)},error:function(a,b,c){console.log(a)}}))})}if(-1!==p.indexOf("create")){var w=$(".create form");w.form({title:{identifier:"create-title",rules:q.title},description:{identifier:"create-description",rules:q.description},genres:{identifier:"create-genres",rules:[{type:"empty_genres",prompt:m[k].EMPTY}]},license:{identifier:"create-license",rules:q.checked},
type:{identifier:"create-type",rules:q.checked}},{rules:{empty_genres:function(){return 0<$('[name="create-genres"]')[0].children.length}},inline:!0,onSuccess:function(){$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,b,c){x(a.responseJSON.error_list,w.find("h1"))}});return!1}});var r=$("#genres"),M=$('select[name="create-genres"]'),g=$('select[name="available-genres"]');$("#available-genres").on("keyup",
function(a){a=this.value;for(var b=g[0],c=0;c<b.length;c++)0>b[c].innerHTML.indexOf(a)?$(b[c]).attr("hidden","true"):$(b[c]).removeAttr("hidden")});$("#taken-genres").on("keyup",function(a){a=this.value;for(var b=M[0],c=0;c<b.length;c++)0>b[c].innerHTML.indexOf(a)?$(b[c]).attr("hidden","true"):$(b[c]).removeAttr("hidden")});$("#add").on("click",function(a){a=g.find("option:selected");for(var b=0;b<a.length;b++)M.append(a[b])});$("#remove").on("click",function(a){a=M.find("option:selected");for(var b=
0;b<a.length;b++)g.append(a[b])});r.on("dblclick",'select[name="create-genres"] option',function(a){g.append(this);M.find("option").each(function(){$(this).attr("selected","selected")})});r.on("dblclick",'select[name="available-genres"] option',function(a){M.append(this)})}if(-1!==p.indexOf("contribute")){var t=$(".contribute-form");tinymce.init({selector:'textarea[name="contribute-content"]'});t.form({title:{identifier:"contribute-title",rules:q.title}},{inline:!0,onSuccess:function(){$.ajax({type:this.method,
url:this.action,data:{"contribute-title":t.find('[name="contribute-title"]')[0].value,"contribute-content":tinymce.get("contribute-content").getContent(),_csrf_token:t.find('[name="_csrf_token"]')[0].value},success:function(a){window.location=a.url},error:function(a,b,c){x(a.responseJSON.error_list,t.find("h1"))}});return!1}})}if(-1!==p.indexOf("settings"))$("#form-delete").on("submit",function(a){a.preventDefault();a=$(this).find("button")[0].value;var b=prompt(m[k].DELETE_MODAL_MESSAGE);b&&(b===
a?$.ajax({type:this.method,url:this.action,datatype:"json",data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,b,c){console.log(a)}}):($(this).find("div").remove(),$(this).append('<div class="ui red message">'+m[k].DELETE_MODAL_WRONG_TITLE+"</div>")));return!1})});"use strict";
(function(k){function p(b,d,h){var c=0,e=[0],g="",l=null,g=h||"UTF8";if("UTF8"!==g&&"UTF16BE"!==g&&"UTF16LE"!==g)throw"encoding must be UTF8, UTF16BE, or UTF16LE";if("HEX"===d){if(0!==b.length%2)throw"srcString of HEX type must be in byte increments";l=q(b);c=l.binLen;e=l.value}else if("TEXT"===d)l=m(b,g),c=l.binLen,e=l.value;else if("B64"===d)l=x(b),c=l.binLen,e=l.value;else if("BYTES"===d)l=C(b),c=l.binLen,e=l.value;else throw"inputFormat must be HEX, TEXT, B64, or BYTES";this.getHash=function(b,
d,g,h){var l=null,f=e.slice(),m=c,k;3===arguments.length?"number"!==typeof g&&(h=g,g=1):2===arguments.length&&(g=1);if(g!==parseInt(g,10)||1>g)throw"numRounds must a integer >= 1";switch(d){case "HEX":l=B;break;case "B64":l=z;break;case "BYTES":l=A;break;default:throw"format must be HEX, B64, or BYTES";}if("SHA-224"===b)for(k=0;k<g;k+=1)f=r(f,m,b),m=224;else if("SHA-256"===b)for(k=0;k<g;k+=1)f=r(f,m,b),m=256;else throw"Chosen SHA variant is not supported";return l(f,D(h))};this.getHMAC=function(b,
d,h,l,k){var f,w,p,t,a=[],n=[];switch(l){case "HEX":l=B;break;case "B64":l=z;break;case "BYTES":l=A;break;default:throw"outputFormat must be HEX, B64, or BYTES";}if("SHA-224"===h)w=64,t=224;else if("SHA-256"===h)w=64,t=256;else throw"Chosen SHA variant is not supported";if("HEX"===d)f=q(b),p=f.binLen,f=f.value;else if("TEXT"===d)f=m(b,g),p=f.binLen,f=f.value;else if("B64"===d)f=x(b),p=f.binLen,f=f.value;else if("BYTES"===d)f=C(b),p=f.binLen,f=f.value;else throw"inputFormat must be HEX, TEXT, B64, or BYTES";
b=8*w;d=w/4-1;if(w<p/8){for(f=r(f,p,h);f.length<=d;)f.push(0);f[d]&=4294967040}else if(w>p/8){for(;f.length<=d;)f.push(0);f[d]&=4294967040}for(w=0;w<=d;w+=1)a[w]=f[w]^909522486,n[w]=f[w]^1549556828;h=r(n.concat(r(a.concat(e),b+c,h)),b+t,h);return l(h,D(k))}}function m(b,d){var h=[],c,e=[],g=0,l,k,m;if("UTF8"===d)for(l=0;l<b.length;l+=1)for(c=b.charCodeAt(l),e=[],128>c?e.push(c):2048>c?(e.push(192|c>>>6),e.push(128|c&63)):55296>c||57344<=c?e.push(224|c>>>12,128|c>>>6&63,128|c&63):(l+=1,c=65536+((c&
1023)<<10|b.charCodeAt(l)&1023),e.push(240|c>>>18,128|c>>>12&63,128|c>>>6&63,128|c&63)),k=0;k<e.length;k+=1){for(m=g>>>2;h.length<=m;)h.push(0);h[m]|=e[k]<<24-g%4*8;g+=1}else if("UTF16BE"===d||"UTF16LE"===d)for(l=0;l<b.length;l+=1){c=b.charCodeAt(l);"UTF16LE"===d&&(k=c&255,c=k<<8|c>>8);for(m=g>>>2;h.length<=m;)h.push(0);h[m]|=c<<16-g%4*8;g+=2}return{value:h,binLen:8*g}}function q(b){var d=[],h=b.length,c,e,g;if(0!==h%2)throw"String of HEX type must be in byte increments";for(c=0;c<h;c+=2){e=parseInt(b.substr(c,
2),16);if(isNaN(e))throw"String of HEX type contains invalid characters";for(g=c>>>3;d.length<=g;)d.push(0);d[c>>>3]|=e<<24-c%8*4}return{value:d,binLen:4*h}}function C(b){var d=[],h,c,e;for(c=0;c<b.length;c+=1)h=b.charCodeAt(c),e=c>>>2,d.length<=e&&d.push(0),d[e]|=h<<24-c%4*8;return{value:d,binLen:8*b.length}}function x(b){var d=[],h=0,c,e,g,l,k;if(-1===b.search(/^[a-zA-Z0-9=+\/]+$/))throw"Invalid character in base-64 string";e=b.indexOf("=");b=b.replace(/\=/g,"");if(-1!==e&&e<b.length)throw"Invalid '=' found in base-64 string";
for(e=0;e<b.length;e+=4){k=b.substr(e,4);for(g=l=0;g<k.length;g+=1)c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(k[g]),l|=c<<18-6*g;for(g=0;g<k.length-1;g+=1){for(c=h>>>2;d.length<=c;)d.push(0);d[c]|=(l>>>16-8*g&255)<<24-h%4*8;h+=1}}return{value:d,binLen:8*h}}function B(b,d){var h="",c=4*b.length,e,g;for(e=0;e<c;e+=1)g=b[e>>>2]>>>8*(3-e%4),h+="0123456789abcdef".charAt(g>>>4&15)+"0123456789abcdef".charAt(g&15);return d.outputUpper?h.toUpperCase():h}function z(b,d){var h=
"",c=4*b.length,e,g,l;for(e=0;e<c;e+=3)for(l=e+1>>>2,g=b.length<=l?0:b[l],l=e+2>>>2,l=b.length<=l?0:b[l],l=(b[e>>>2]>>>8*(3-e%4)&255)<<16|(g>>>8*(3-(e+1)%4)&255)<<8|l>>>8*(3-(e+2)%4)&255,g=0;4>g;g+=1)h=8*e+6*g<=32*b.length?h+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>6*(3-g)&63):h+d.b64Pad;return h}function A(b){var d="",h=4*b.length,c,e;for(c=0;c<h;c+=1)e=b[c>>>2]>>>8*(3-c%4)&255,d+=String.fromCharCode(e);return d}function D(b){var d={outputUpper:!1,b64Pad:"="};
try{b.hasOwnProperty("outputUpper")&&(d.outputUpper=b.outputUpper),b.hasOwnProperty("b64Pad")&&(d.b64Pad=b.b64Pad)}catch(h){}if("boolean"!==typeof d.outputUpper)throw"Invalid outputUpper formatting option";if("string"!==typeof d.b64Pad)throw"Invalid b64Pad formatting option";return d}function u(b,d){return b>>>d|b<<32-d}function G(b,d,h){return b&d^~b&h}function J(b,d,h){return b&d^b&h^d&h}function N(b){return u(b,2)^u(b,13)^u(b,22)}function O(b){return u(b,6)^u(b,11)^u(b,25)}function E(b){return u(b,
7)^u(b,18)^b>>>3}function F(b){return u(b,17)^u(b,19)^b>>>10}function K(b,d){var h=(b&65535)+(d&65535);return((b>>>16)+(d>>>16)+(h>>>16)&65535)<<16|h&65535}function L(b,d,h,c){var e=(b&65535)+(d&65535)+(h&65535)+(c&65535);return((b>>>16)+(d>>>16)+(h>>>16)+(c>>>16)+(e>>>16)&65535)<<16|e&65535}function y(b,d,h,c,e){var g=(b&65535)+(d&65535)+(h&65535)+(c&65535)+(e&65535);return((b>>>16)+(d>>>16)+(h>>>16)+(c>>>16)+(e>>>16)+(g>>>16)&65535)<<16|g&65535}function r(b,d,h){var c,e,g,l,k,m,q,p,r,f,w,u,t,a,
n,v,x,z,A,B,C,D,T,U,V,H=[],W,X=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,
3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];f=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428];e=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];if("SHA-224"===h||"SHA-256"===h)w=64,c=(d+65>>>9<<4)+15,a=16,n=1,V=Number,v=K,x=L,z=y,A=E,B=F,C=N,D=O,U=J,
T=G,f="SHA-224"===h?f:e;else throw"Unexpected error in SHA-2 implementation";for(;b.length<=c;)b.push(0);b[d>>>5]|=128<<24-d%32;b[c]=d;W=b.length;for(u=0;u<W;u+=a){d=f[0];c=f[1];e=f[2];g=f[3];l=f[4];k=f[5];m=f[6];q=f[7];for(t=0;t<w;t+=1)16>t?(r=t*n+u,p=b.length<=r?0:b[r],r=b.length<=r+1?0:b[r+1],H[t]=new V(p,r)):H[t]=x(B(H[t-2]),H[t-7],A(H[t-15]),H[t-16]),p=z(q,D(l),T(l,k,m),X[t],H[t]),r=v(C(d),U(d,c,e)),q=m,m=k,k=l,l=v(g,p),g=e,e=c,c=d,d=v(p,r);f[0]=v(d,f[0]);f[1]=v(c,f[1]);f[2]=v(e,f[2]);f[3]=v(g,
f[3]);f[4]=v(l,f[4]);f[5]=v(k,f[5]);f[6]=v(m,f[6]);f[7]=v(q,f[7])}if("SHA-224"===h)b=[f[0],f[1],f[2],f[3],f[4],f[5],f[6]];else if("SHA-256"===h)b=f;else throw"Unexpected error in SHA-2 implementation";return b}"function"===typeof define&&define.amd?define(function(){return p}):"undefined"!==typeof exports?"undefined"!==typeof module&&module.exports?module.exports=exports=p:exports=p:k.jsSHA=p})(this);