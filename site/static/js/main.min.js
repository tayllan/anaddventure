$(document).ready(function(){var g=$('[name="selected-language"]').val(),q=window.location.pathname,m={en:{NAME_MIN:"Must have at least 3 characters",NAME_MAX:"Can have at most 50 characters",USERNAME_MIN:"Must have at least 3 characters",USERNAME_MAX:"Can have at most 50 characters",EMAIL:"This is not a valid email address",EMAIL_MAX:"Can have at most 50 characters",PASSWORD_MIN:"Must have at least 6 characters",BIOGRAPHY_MAX:"Can have at most 500 characters",TITLE_MAX:"Can have at most 500 characters",
DESCRIPTION_MAX:"Can have at most 500 characters",EMPTY:"This field is required",CHECKED:"This field is required",UNWATCH:"Unwatch",WATCH:"Watch",UNSTAR:"Unstar",STAR:"Star",MATCH:"This field must match the field above",AVATAR_FORMAT:"Unfortunately, we only support PNG, GIF, or JPG pictures",AVATAR_SIZE:"Unfortunately, we only support pictures with up to 1 MB size",ADD_AVATAR:"Upload new picture",TOO_WEAK:"Too Weak",WEAK:"Weak",GOOD:"Good",STRONG:"Strong",DELETE_MODAL_MESSAGE:"Are you ABSOLUTELY sure?\nIf so, please type in the title of the tale to confirm.",
DELETE_MODAL_WRONG_TITLE:"Wrong tale title"},pt:{NAME_MIN:"Deve conter ao menos 3 caracteres",NAME_MAX:"Pode conter no m\u00e1ximo 50 caracters",USERNAME_MIN:"Deve conter ao menos 3 caracteres",USERNAME_MAX:"Pode conter no m\u00e1ximo 50 caracters",EMAIL:"Este n\u00e3o \u00e9 um email v\u00e1lido",EMAIL_MAX:"Pode conter no m\u00e1ximo 50 caracters",PASSWORD_MIN:"Deve conter ao menos 6 caracteres",BIOGRAPHY_MAX:"Pode conter no m\u00e1ximo 500 caracteres",TITLE_MAX:"Pode conter no m\u00e1ximo 500 caracteres",
DESCRIPTION_MAX:"Pode conter no m\u00e1ximo 500 caracteres",EMPTY:"Este campo \u00e9 obrigat\u00f3rio",CHECKED:"Este campo \u00e9 obrigat\u00f3rio",UNWATCH:"Parar de Seguir",WATCH:"Seguir",UNSTAR:"Tirar Recomenda\u00e7\u00e3o",STAR:"Recomendar",MATCH:"Este campo deve ser igual ao de cima",AVATAR_FORMAT:"Infelizmente, suportamos apenas imagens em PGN, GIF ou JPG",AVATAR_SIZE:"Infelizmente, suportamos apenas imagens com tamanho de at\u00e9 1 MB",ADD_AVATAR:"Enviar nova imagem",TOO_WEAK:"Muito fraca",
WEAK:"Fraca",GOOD:"Boa",STRONG:"Forte",DELETE_MODAL_MESSAGE:"Voc\u00ea tem certeza ABSOLUTA?\nSe sim, por favor digite o t\u00edtulo do conto para confirmar.",DELETE_MODAL_WRONG_TITLE:"T\u00edtulo do conto errado"}},p={name:[{type:"length[3]",prompt:m[g].NAME_MIN},{type:"maxLength[50]",prompt:m[g].NAME_MAX}],username:[{type:"length[3]",prompt:m[g].USERNAME_MIN},{type:"maxLength[50]",prompt:m[g].USERNAME_MAX}],email:[{type:"email",prompt:m[g].EMAIL},{type:"maxLength[50]",prompt:m[g].EMAIL_MAX}],password:[{type:"length[6]",
prompt:m[g].PASSWORD_MIN}],biography:[{type:"maxLength[500]",prompt:m[g].BIOGRAPHY_MAX}],title:[{type:"empty",prompt:m[g].EMPTY},{type:"maxLength[500]",prompt:m[g].TITLE_MAX}],description:[{type:"maxLength[500]",prompt:m[g].DESCRIPTION_MAX}],empty:[{type:"empty",prompt:m[g].EMPTY}],checked:[{type:"checked",prompt:m[g].CHECKED}],match:function(a){return[{type:"match["+a+"]",prompt:m[g].MATCH}]}},C=function(a){if(6>a.length)return 0;if(8>a.length)return 1;var d=0;/[a-z]/.test(a)&&++d;/[A-Z]/.test(a)&&
++d;/[0-9]/.test(a)&&++d;/[@#$%&\*\(\)!\-\+]/.test(a)&&++d;return 1==d?1:2==d?2:3},w=function(a,d,v){var b='<ul class="ui negative message" id="messages-list">';v&&(b='<ul class="ui positive message" id="messages-list">');for(v=a.length-1;0<=v;v--)b+="<li>"+a[v]+"</li>";b+="</ul>";$("#messages-list").remove();d.after(b)};$("#language-en, #language-pt").on("click",function(a){a.preventDefault();a=/\-(\w+)/.exec(this.id)[1];$.ajax({type:"get",url:"/set_language",datatype:"json",data:{language:a},success:function(a){window.location.reload(!0)},
error:function(a,v,b){console.log(a)}});return!1});$('[name="timezone_offset"]').val()||$.ajax({type:"get",url:"/set_timezone_offset",datatype:"json",data:{timezone_offset:(new Date).getTimezoneOffset()},success:function(a){},error:function(a,d,v){console.log(a)}});if("/"===q){var B=$("#top-all"),z=$("#top-today"),A=$(".top-tales");B.on("click",function(a){z.removeClass("active");B.addClass("active");$.ajax({type:"get",url:"/get_ten_best_tales",datatype:"json",success:function(a){A.find("div").remove();
A.append(a)},error:function(a,v,b){console.log(a)}})});z.on("click",function(a){B.removeClass("active");z.addClass("active");$.ajax({type:"get",url:"/get_ten_best_daily_tales",datatype:"json",success:function(a){A.find("div").remove();A.append(a)},error:function(a,v,b){console.log(a)}})});z.trigger("click")}if(-1!==q.indexOf("join")){var D=$(".login"),r=$(".signup"),G=r.find(".password-strength");r.find('input[name="signup-password"]').on("keyup",function(a){a=C(this.value);G.removeClass();switch(a){case 0:G.addClass("ui yellow label").html(m[g].TOO_WEAK);
break;case 1:G.addClass("ui green label").html(m[g].WEAK);break;case 2:G.addClass("ui blue label").html(m[g].GOOD);break;default:G.addClass("ui red label").html(m[g].STRONG)}});D.find("form").form({username:{identifier:"login-username",rules:p.username},password:{identifier:"login-password",rules:p.password}},{inline:!0,onSuccess:function(){var a=$(this).find('input[type="password"]')[0],d=(new jsSHA(a.value,"TEXT")).getHash("SHA-256","HEX");a.value=d;$.ajax({type:this.method,url:this.action,data:new FormData(this),
processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,d,b){w(a.responseJSON.error_list,D.find("h2"))}});return!1}});r.find("form").form({username:{identifier:"signup-username",rules:p.username},email:{identifier:"signup-email",rules:p.email},password:{identifier:"signup-password",rules:p.password},repeat_password:{identifier:"signup-repeat-password",rules:p.match("signup-password")}},{inline:!0,onSuccess:function(){var a=$(this).find('input[name="signup-password"]')[0],
d=a.value,d=(new jsSHA(d,"TEXT")).getHash("SHA-256","HEX");a.value=d;a=$(this).find('input[name="signup-repeat-password"]')[0];d=a.value;d=(new jsSHA(d,"TEXT")).getHash("SHA-256","HEX");a.value=d;$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){w([a.message],r.find("h2"),!0)},error:function(a,d,b){w(a.responseJSON.error_list,r.find("h2"))}});return!1}})}if(-1!==q.indexOf("password_reset")){var J=$(".password-reset form");J.form({email:{identifier:"password-reset-email",
rules:p.email}},{inline:!0,onSuccess:function(){$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){w([a.message],J.find("h1"),!0)},error:function(a,d,b){w(a.responseJSON.error_list,J.find("h1"))}});return!1}})}if(-1!==q.indexOf("change_password")){var M=$(".change-password form");M.form({password:{identifier:"change-password-new-password",rules:p.password},repeat_password:{identifier:"change-password-confirm-new-password",rules:p.password}},
{inline:!0,onSuccess:function(){var a=$(this).find('input[name="change-password-new-password"]')[0],d=a.value,d=(new jsSHA(d,"TEXT")).getHash("SHA-256","HEX");a.value=d;a=$(this).find('input[name="change-password-confirm-new-password"]')[0];d=a.value;d=(new jsSHA(d,"TEXT")).getHash("SHA-256","HEX");a.value=d;$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,d,b){w(a.responseJSON.error_list,M.find("h1"))}});
return!1}})}if(-1!==q.indexOf("profile")){var N=/profile\/([^\/]+)/.exec(q)[1],E=$(".own"),F=$(".participated"),K=function(a,d,b){$.ajax({type:"get",url:"/get_rendered_own_tales",datatype:"json",data:{username:N,offset:a,search_string:d},success:function(d){E.empty().append(d);b||E.find("input")[0].focus();E.find("#pagination-buttons button").each(function(){parseInt(this.value,10)===parseInt(a,10)?$(this).addClass("disabled"):$(this).removeClass("disabled")})},error:function(a,d,b){console.log(a)}})},
L=function(a,d,b){$.ajax({type:"get",url:"/get_rendered_participated_tales",datatype:"json",data:{username:N,offset:a,search_string:d},success:function(d){F.empty().append(d);b||F.find("input")[0].focus();F.find("#pagination-buttons button").each(function(){parseInt(this.value,10)===parseInt(a,10)?$(this).addClass("disabled"):$(this).removeClass("disabled")})},error:function(a,d,b){console.log(a)}})};E.on("click",".own-pagination",function(a){a.preventDefault();K(this.value,E.find("input")[0].value);
return!1});F.on("click",".participated-pagination",function(a){a.preventDefault();L(this.value,F.find("input")[0].value);return!1});K(0,"",!0);L(0,"",!0);E.on("submit","form",function(a){a.preventDefault();K(0,$(this).find("input")[0].value);return!1});F.on("submit","form",function(a){a.preventDefault();L(0,$(this).find("input")[0].value);return!1})}var y=$(".profile");if(-1!==q.indexOf("update/")){var t=$(".button-update-profile");y.on("change",'input[name="update-avatar"]',function(a){if(a=this.files[0]){var d=
y.find(".button-choose-file"),b=y.find(".label-choose-file");/\.(jpe?g|png|gif)$/i.test(a.name)?1048576>a.size?(d.addClass("green").html(a.name),b.removeClass("ui red label").html("")):(this.value="",this.files=[],d.removeClass("green").html(m[g].ADD_AVATAR),b.addClass("ui red label").html(m[g].AVATAR_SIZE)):(this.value="",this.files=[],d.removeClass("green").html(m[g].ADD_AVATAR),b.addClass("ui red label").html(m[g].AVATAR_FORMAT))}});y.on("click",".button-choose-file",function(a){a.preventDefault();
y.find('input[name="update-avatar"]').trigger("click");return!1});t.on("click",function(a){$.ajax({type:"get",url:"/get_user_info",datatype:"json",data:{user_id:this.value},success:function(a){y.find("form").remove();y.append(a);y.find("form").form({name:{identifier:"update-name",rules:p.name},email:{identifier:"update-email",rules:p.email},email_visibility:{identifier:"update-email-visibility",rules:p.empty},biography:{identifier:"update-biography",rules:p.biography}},{inline:!0,onSuccess:function(){$.ajax({type:this.method,
url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,d,b){w(a.responseJSON.error_list,y.find("h4"))}});return!1},onFailure:function(){return!1}})},error:function(a,b,c){console.log(a)}})});t.trigger("click");$(".button-update-password").on("click",function(a){$.ajax({type:"get",url:"/get_update_password_form",datatype:"json",data:{user_id:this.value},success:function(a){y.find("form").remove();y.append(a);var b=$(".password-strength");
$('input[name="update-new-password"]').on("keyup",function(a){a=C(this.value);b.removeClass();switch(a){case 0:b.addClass("ui yellow label").html(m[g].TOO_WEAK);break;case 1:b.addClass("ui green label").html(m[g].WEAK);break;case 2:b.addClass("ui blue label").html(m[g].GOOD);break;default:b.addClass("ui red label").html(m[g].STRONG)}});y.find("form").form({old_password:{identifier:"update-old-password",rules:p.password},new_password:{identifier:"update-new-password",rules:p.password},confirm_new_password:{identifier:"update-confirm-new-password",
rules:p.match("update-new-password")}},{inline:!0,onSuccess:function(){var a=$(this).find('input[name="update-old-password"]')[0],d=a.value,d=(new jsSHA(d,"TEXT")).getHash("SHA-256","HEX");a.value=d;a=$(this).find('input[name="update-new-password"]')[0];d=a.value;d=(new jsSHA(d,"TEXT")).getHash("SHA-256","HEX");a.value=d;a=$(this).find('input[name="update-confirm-new-password"]')[0];d=a.value;d=(new jsSHA(d,"TEXT")).getHash("SHA-256","HEX");a.value=d;$.ajax({type:this.method,url:this.action,data:new FormData(this),
processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,d,b){w(a.responseJSON.error_list,y.find("h4"))}});return!1},onFailure:function(){return!1}})},error:function(a,b,c){console.log(a)}})})}t=$(".upper-bar");if(0<t.length){var b=$("#to-fullscreen"),e=$("#fullscreen");t.on("submit",".form-unfollow",function(a){a.preventDefault();var d=$(".form-unfollow"),b=d[0].action;$.ajax({type:"post",url:b,datatype:"json",data:new FormData(this),processData:!1,contentType:!1,
success:function(a){d.find("button")[0].innerHTML='<i class="unhide icon"></i>'+m[g].WATCH+" "+a.followers;d.attr("action",b.replace("unfollow","follow"));d.attr("class","form-follow column")},error:function(a,d,b){console.log(a)}});return!1});t.on("submit",".form-follow",function(a){a.preventDefault();var d=$(".form-follow"),b=d[0].action;$.ajax({type:"post",url:b,datatype:"json",data:new FormData(this),processData:!1,contentType:!1,success:function(a){a.error?window.location=a.error:(d.find("button")[0].innerHTML=
'<i class="unhide icon"></i>'+m[g].UNWATCH+" "+a.followers,d.attr("action",b.replace("follow","unfollow")),d.attr("class","form-unfollow column"))},error:function(a,d,b){console.log(a)}});return!1});t.on("submit",".form-unstar",function(a){a.preventDefault();var d=$(".form-unstar"),b=d[0].action;$.ajax({type:"post",url:b,datatype:"json",data:new FormData(this),processData:!1,contentType:!1,success:function(a){d.find("button")[0].innerHTML='<i class="star icon"></i>'+m[g].STAR+" "+a.stars;d.attr("action",
b.replace("unstar","star"));d.attr("class","form-star column")},error:function(a,d,b){console.log(a)}});return!1});t.on("submit",".form-star",function(a){a.preventDefault();var d=$(".form-star"),b=d[0].action;$.ajax({type:"post",url:b,datatype:"json",data:new FormData(this),processData:!1,contentType:!1,success:function(a){a.error?window.location=a.error:(d.find("button")[0].innerHTML='<i class="star icon"></i>'+m[g].UNSTAR+" "+a.stars,d.attr("action",b.replace("star","unstar")),d.attr("class","form-unstar column"))},
error:function(a,d,b){console.log(a)}});return!1});-1!==q.indexOf("/fullscreen")&&e.modal("show");b.on("click",function(a){e.modal("show")})}if(-1!==q.indexOf("update_tale")){var h=$(".main form");h.form({title:{identifier:"update-tale-title",rules:p.title},description:{identifier:"update-tale-description",rules:p.description},genres:{identifier:"update-tale-genres",rules:[{type:"empty_genres",prompt:m[g].EMPTY}]},license:{identifier:"update-tale-license",rules:p.checked},type:{identifier:"update-tale-type",
rules:p.checked}},{rules:{empty_genres:function(){return 0<$('[name="update-tale-genres"]')[0].children.length}},inline:!0,onSuccess:function(){$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,d,b){w(a.responseJSON.error_list,h.find("h1"))}});return!1}});var t=$("#genres"),c=$('select[name="update-tale-genres"]'),f=$('select[name="available-genres"]');$("#available-genres").on("keyup",function(a){a=
this.value;for(var b=f[0],c=0;c<b.length;c++)0>b[c].innerHTML.indexOf(a)?$(b[c]).attr("hidden","true"):$(b[c]).removeAttr("hidden")});$("#taken-genres").on("keyup",function(a){a=this.value;for(var b=c[0],f=0;f<b.length;f++)0>b[f].innerHTML.indexOf(a)?$(b[f]).attr("hidden","true"):$(b[f]).removeAttr("hidden")});$("#add").on("click",function(a){a=f.find("option:selected");for(var b=0;b<a.length;b++)c.append(a[b])});$("#remove").on("click",function(a){a=c.find("option:selected");for(var b=0;b<a.length;b++)f.append(a[b])});
t.on("dblclick",'select[name="update-tale-genres"] option',function(a){f.append(this);c.find("option").each(function(){$(this).attr("selected","selected")})});t.on("dblclick",'select[name="available-genres"] option',function(a){c.append(this)})}$(".results");if(-1!==q.indexOf("search")){$("#layout-search-bar").empty();$('input[name="content"]').focus();var n=$(".main-block"),l=1;$.ajax({type:"get",url:"/search_tales"+window.location.search,datatype:"json",success:function(a){n.empty().append(a)},
error:function(a,b,c){console.log(a)}});var R=function(a,b){$.ajax({type:"get",url:a,datatype:"json",data:{"sort-value":b},success:function(b){n.empty().append(b);l=a.indexOf("tales")},error:function(a,b,d){console.log(a)}})};$(".search-block").on("click",".search-tales, .search-users",function(a){a.preventDefault();R(this.href,1);return!1});n.on("change","#sort-bar",function(a){a="";a=0<=l?$(".search-tales")[0].href:$(".search-users")[0].href;R(a,$(this).find("option:selected")[0].value)})}var I=
$(".contribution-requests");if(-1!==q.indexOf("contribution_requests")){var S=/contribution_requests\/([0-9]+)/.exec(window.location)[1],O=$(".o-c-r"),Q=$(".c-c-r");O.on("click",function(a){1!==I.find(".open-contribution-requests").length&&(console.log("HERE"),O.addClass("active"),Q.removeClass("active"),$.ajax({type:"get",url:"/get_open_contribution_requests",datatype:"json",data:{tale_id:S},success:function(a){I.find(".closed-contribution-requests").remove();I.append(a)},error:function(a,b,c){console.log(a)}}))});
O.trigger("click");Q.on("click",function(a){1!==I.find(".closed-contribution-requests").length&&(Q.addClass("active"),O.removeClass("active"),$.ajax({type:"get",url:"/get_closed_contribution_requests",datatype:"json",data:{tale_id:S},success:function(a){I.find(".open-contribution-requests").remove();I.append(a)},error:function(a,b,c){console.log(a)}}))})}if(-1!==q.indexOf("create")){var k=$(".create form");k.form({title:{identifier:"create-title",rules:p.title},description:{identifier:"create-description",
rules:p.description},genres:{identifier:"create-genres",rules:[{type:"empty_genres",prompt:m[g].EMPTY}]},license:{identifier:"create-license",rules:p.checked},type:{identifier:"create-type",rules:p.checked}},{rules:{empty_genres:function(){return 0<$('[name="create-genres"]')[0].children.length}},inline:!0,onSuccess:function(){$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,b,c){w(a.responseJSON.error_list,
k.find("h1"))}});return!1}});var t=$("#genres"),u=$('select[name="create-genres"]'),f=$('select[name="available-genres"]');$("#available-genres").on("keyup",function(a){a=this.value;for(var b=f[0],c=0;c<b.length;c++)0>b[c].innerHTML.indexOf(a)?$(b[c]).attr("hidden","true"):$(b[c]).removeAttr("hidden")});$("#taken-genres").on("keyup",function(a){a=this.value;for(var b=u[0],c=0;c<b.length;c++)0>b[c].innerHTML.indexOf(a)?$(b[c]).attr("hidden","true"):$(b[c]).removeAttr("hidden")});$("#add").on("click",
function(a){a=f.find("option:selected");for(var b=0;b<a.length;b++)u.append(a[b])});$("#remove").on("click",function(a){a=u.find("option:selected");for(var b=0;b<a.length;b++)f.append(a[b])});t.on("dblclick",'select[name="create-genres"] option',function(a){f.append(this);u.find("option").each(function(){$(this).attr("selected","selected")})});t.on("dblclick",'select[name="available-genres"] option',function(a){u.append(this)})}if(-1!==q.indexOf("contribute")){var P=$(".contribute-form");tinymce.init({selector:'textarea[name="contribute-content"]'});
P.form({title:{identifier:"contribute-title",rules:p.title}},{inline:!0,onSuccess:function(){$.ajax({type:this.method,url:this.action,data:{"contribute-title":P.find('[name="contribute-title"]')[0].value,"contribute-content":tinymce.get("contribute-content").getContent(),_csrf_token:P.find('[name="_csrf_token"]')[0].value},success:function(a){window.location=a.url},error:function(a,b,c){w(a.responseJSON.error_list,P.find("h1"))}});return!1}})}if(-1!==q.indexOf("settings"))$("#form-delete").on("submit",
function(a){a.preventDefault();a=$(this).find("button")[0].value;var b=prompt(m[g].DELETE_MODAL_MESSAGE);b&&(b===a?$.ajax({type:this.method,url:this.action,datatype:"json",data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,b,c){console.log(a)}}):($(this).find("div").remove(),$(this).append('<div class="ui red message">'+m[g].DELETE_MODAL_WRONG_TITLE+"</div>")));return!1});if(-1!==q.indexOf("contact")){var x=$(".contact-form");x.form({name:{identifier:"contact-name",
rules:p.name},email:{identifier:"contact-email",rules:p.email},message:{identifier:"contact-message",rules:p.empty}},{inline:!0,onSuccess:function(){$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){var b=$("#received-message");b.html(a);b.addClass("ui positive message")},error:function(a,b,c){w(a.responseJSON.error_list,x.find("h1"))}});return!1}})}});"use strict";
(function(g){function q(b,e,h){var c=0,f=[0],n="",l=null,n=h||"UTF8";if("UTF8"!==n&&"UTF16BE"!==n&&"UTF16LE"!==n)throw"encoding must be UTF8, UTF16BE, or UTF16LE";if("HEX"===e){if(0!==b.length%2)throw"srcString of HEX type must be in byte increments";l=p(b);c=l.binLen;f=l.value}else if("TEXT"===e)l=m(b,n),c=l.binLen,f=l.value;else if("B64"===e)l=w(b),c=l.binLen,f=l.value;else if("BYTES"===e)l=C(b),c=l.binLen,f=l.value;else throw"inputFormat must be HEX, TEXT, B64, or BYTES";this.getHash=function(b,
e,h,n){var l=null,k=f.slice(),m=c,g;3===arguments.length?"number"!==typeof h&&(n=h,h=1):2===arguments.length&&(h=1);if(h!==parseInt(h,10)||1>h)throw"numRounds must a integer >= 1";switch(e){case "HEX":l=B;break;case "B64":l=z;break;case "BYTES":l=A;break;default:throw"format must be HEX, B64, or BYTES";}if("SHA-224"===b)for(g=0;g<h;g+=1)k=t(k,m,b),m=224;else if("SHA-256"===b)for(g=0;g<h;g+=1)k=t(k,m,b),m=256;else throw"Chosen SHA variant is not supported";return l(k,D(n))};this.getHMAC=function(b,
e,h,l,g){var k,u,q,x,a=[],d=[];switch(l){case "HEX":l=B;break;case "B64":l=z;break;case "BYTES":l=A;break;default:throw"outputFormat must be HEX, B64, or BYTES";}if("SHA-224"===h)u=64,x=224;else if("SHA-256"===h)u=64,x=256;else throw"Chosen SHA variant is not supported";if("HEX"===e)k=p(b),q=k.binLen,k=k.value;else if("TEXT"===e)k=m(b,n),q=k.binLen,k=k.value;else if("B64"===e)k=w(b),q=k.binLen,k=k.value;else if("BYTES"===e)k=C(b),q=k.binLen,k=k.value;else throw"inputFormat must be HEX, TEXT, B64, or BYTES";
b=8*u;e=u/4-1;if(u<q/8){for(k=t(k,q,h);k.length<=e;)k.push(0);k[e]&=4294967040}else if(u>q/8){for(;k.length<=e;)k.push(0);k[e]&=4294967040}for(u=0;u<=e;u+=1)a[u]=k[u]^909522486,d[u]=k[u]^1549556828;h=t(d.concat(t(a.concat(f),b+c,h)),b+x,h);return l(h,D(g))}}function m(b,e){var h=[],c,f=[],n=0,l,g,m;if("UTF8"===e)for(l=0;l<b.length;l+=1)for(c=b.charCodeAt(l),f=[],128>c?f.push(c):2048>c?(f.push(192|c>>>6),f.push(128|c&63)):55296>c||57344<=c?f.push(224|c>>>12,128|c>>>6&63,128|c&63):(l+=1,c=65536+((c&
1023)<<10|b.charCodeAt(l)&1023),f.push(240|c>>>18,128|c>>>12&63,128|c>>>6&63,128|c&63)),g=0;g<f.length;g+=1){for(m=n>>>2;h.length<=m;)h.push(0);h[m]|=f[g]<<24-n%4*8;n+=1}else if("UTF16BE"===e||"UTF16LE"===e)for(l=0;l<b.length;l+=1){c=b.charCodeAt(l);"UTF16LE"===e&&(g=c&255,c=g<<8|c>>8);for(m=n>>>2;h.length<=m;)h.push(0);h[m]|=c<<16-n%4*8;n+=2}return{value:h,binLen:8*n}}function p(b){var e=[],h=b.length,c,f,n;if(0!==h%2)throw"String of HEX type must be in byte increments";for(c=0;c<h;c+=2){f=parseInt(b.substr(c,
2),16);if(isNaN(f))throw"String of HEX type contains invalid characters";for(n=c>>>3;e.length<=n;)e.push(0);e[c>>>3]|=f<<24-c%8*4}return{value:e,binLen:4*h}}function C(b){var e=[],h,c,f;for(c=0;c<b.length;c+=1)h=b.charCodeAt(c),f=c>>>2,e.length<=f&&e.push(0),e[f]|=h<<24-c%4*8;return{value:e,binLen:8*b.length}}function w(b){var e=[],h=0,c,f,n,l,g;if(-1===b.search(/^[a-zA-Z0-9=+\/]+$/))throw"Invalid character in base-64 string";f=b.indexOf("=");b=b.replace(/\=/g,"");if(-1!==f&&f<b.length)throw"Invalid '=' found in base-64 string";
for(f=0;f<b.length;f+=4){g=b.substr(f,4);for(n=l=0;n<g.length;n+=1)c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(g[n]),l|=c<<18-6*n;for(n=0;n<g.length-1;n+=1){for(c=h>>>2;e.length<=c;)e.push(0);e[c]|=(l>>>16-8*n&255)<<24-h%4*8;h+=1}}return{value:e,binLen:8*h}}function B(b,e){var h="",c=4*b.length,f,g;for(f=0;f<c;f+=1)g=b[f>>>2]>>>8*(3-f%4),h+="0123456789abcdef".charAt(g>>>4&15)+"0123456789abcdef".charAt(g&15);return e.outputUpper?h.toUpperCase():h}function z(b,e){var h=
"",c=4*b.length,f,g,l;for(f=0;f<c;f+=3)for(l=f+1>>>2,g=b.length<=l?0:b[l],l=f+2>>>2,l=b.length<=l?0:b[l],l=(b[f>>>2]>>>8*(3-f%4)&255)<<16|(g>>>8*(3-(f+1)%4)&255)<<8|l>>>8*(3-(f+2)%4)&255,g=0;4>g;g+=1)h=8*f+6*g<=32*b.length?h+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>6*(3-g)&63):h+e.b64Pad;return h}function A(b){var e="",h=4*b.length,c,f;for(c=0;c<h;c+=1)f=b[c>>>2]>>>8*(3-c%4)&255,e+=String.fromCharCode(f);return e}function D(b){var e={outputUpper:!1,b64Pad:"="};
try{b.hasOwnProperty("outputUpper")&&(e.outputUpper=b.outputUpper),b.hasOwnProperty("b64Pad")&&(e.b64Pad=b.b64Pad)}catch(h){}if("boolean"!==typeof e.outputUpper)throw"Invalid outputUpper formatting option";if("string"!==typeof e.b64Pad)throw"Invalid b64Pad formatting option";return e}function r(b,e){return b>>>e|b<<32-e}function G(b,e,h){return b&e^~b&h}function J(b,e,h){return b&e^b&h^e&h}function M(b){return r(b,2)^r(b,13)^r(b,22)}function N(b){return r(b,6)^r(b,11)^r(b,25)}function E(b){return r(b,
7)^r(b,18)^b>>>3}function F(b){return r(b,17)^r(b,19)^b>>>10}function K(b,e){var h=(b&65535)+(e&65535);return((b>>>16)+(e>>>16)+(h>>>16)&65535)<<16|h&65535}function L(b,e,h,c){var f=(b&65535)+(e&65535)+(h&65535)+(c&65535);return((b>>>16)+(e>>>16)+(h>>>16)+(c>>>16)+(f>>>16)&65535)<<16|f&65535}function y(b,e,h,c,f){var g=(b&65535)+(e&65535)+(h&65535)+(c&65535)+(f&65535);return((b>>>16)+(e>>>16)+(h>>>16)+(c>>>16)+(f>>>16)+(g>>>16)&65535)<<16|g&65535}function t(b,e,h){var c,f,g,l,m,p,q,t,r,k,u,w,x,a,
d,v,z,A,B,C,D,T,U,V,W,H=[],X,Y=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,
3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];k=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428];f=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];if("SHA-224"===h||"SHA-256"===h)u=64,c=(e+65>>>9<<4)+15,a=16,d=1,W=Number,v=K,z=L,A=y,B=E,C=F,D=M,T=N,V=J,
U=G,k="SHA-224"===h?k:f;else throw"Unexpected error in SHA-2 implementation";for(;b.length<=c;)b.push(0);b[e>>>5]|=128<<24-e%32;b[c]=e;X=b.length;for(w=0;w<X;w+=a){e=k[0];c=k[1];f=k[2];g=k[3];l=k[4];m=k[5];p=k[6];q=k[7];for(x=0;x<u;x+=1)16>x?(r=x*d+w,t=b.length<=r?0:b[r],r=b.length<=r+1?0:b[r+1],H[x]=new W(t,r)):H[x]=z(C(H[x-2]),H[x-7],B(H[x-15]),H[x-16]),t=A(q,T(l),U(l,m,p),Y[x],H[x]),r=v(D(e),V(e,c,f)),q=p,p=m,m=l,l=v(g,t),g=f,f=c,c=e,e=v(t,r);k[0]=v(e,k[0]);k[1]=v(c,k[1]);k[2]=v(f,k[2]);k[3]=v(g,
k[3]);k[4]=v(l,k[4]);k[5]=v(m,k[5]);k[6]=v(p,k[6]);k[7]=v(q,k[7])}if("SHA-224"===h)b=[k[0],k[1],k[2],k[3],k[4],k[5],k[6]];else if("SHA-256"===h)b=k;else throw"Unexpected error in SHA-2 implementation";return b}"function"===typeof define&&define.amd?define(function(){return q}):"undefined"!==typeof exports?"undefined"!==typeof module&&module.exports?module.exports=exports=q:exports=q:g.jsSHA=q})(this);