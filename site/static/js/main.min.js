$(document).ready(function(){var f=$("#selected-language")[0].innerHTML,q=window.location.pathname,l={en:{NAME_MIN:"Must have at least 3 characters",NAME_MAX:"Can have at most 50 characters",USERNAME_MIN:"Must have at least 3 characters",USERNAME_MAX:"Can have at most 50 characters",EMAIL:"This is not a valid email address",EMAIL_MAX:"Can have at most 50 characters",PASSWORD_MIN:"Must have at least 6 characters",BIOGRAPHY_MAX:"Can have at most 500 characters",TITLE_MAX:"Can have at most 500 characters",
DESCRIPTION_MAX:"Can have at most 500 characters",EMPTY:"This field is required",CHECKED:"This field is required",UNWATCH:"Unwatch",WATCH:"Watch",UNSTAR:"Unstar",STAR:"Star",MATCH:"This field must match the field above",AVATAR_FORMAT:"Unfortunately, we only support PNG, GIF, or JPG pictures",AVATAR_SIZE:"Unfortunately, we only support pictures with up to 1 MB size",ADD_AVATAR:"Upload new picture",TOO_WEAK:"Too Weak",WEAK:"Weak",GOOD:"Good",STRONG:"Strong",DELETE_MODAL_MESSAGE:"Are you ABSOLUTELY sure?\nIf so, please type in the title of the tale to confirm.",
DELETE_MODAL_WRONG_TITLE:"Wrong tale title"},pt:{NAME_MIN:"Deve conter ao menos 3 caracteres",NAME_MAX:"Pode conter no m\u00e1ximo 50 caracters",USERNAME_MIN:"Deve conter ao menos 3 caracteres",USERNAME_MAX:"Pode conter no m\u00e1ximo 50 caracters",EMAIL:"Este n\u00e3o \u00e9 um email v\u00e1lido",EMAIL_MAX:"Pode conter no m\u00e1ximo 50 caracters",PASSWORD_MIN:"Deve conter ao menos 6 caracteres",BIOGRAPHY_MAX:"Pode conter no m\u00e1ximo 500 caracteres",TITLE_MAX:"Pode conter no m\u00e1ximo 500 caracteres",
DESCRIPTION_MAX:"Pode conter no m\u00e1ximo 500 caracteres",EMPTY:"Este campo \u00e9 obrigat\u00f3rio",CHECKED:"Este campo \u00e9 obrigat\u00f3rio",UNWATCH:"Parar de Seguir",WATCH:"Seguir",UNSTAR:"Tirar Recomenda\u00e7\u00e3o",STAR:"Recomendar",MATCH:"Este campo deve ser igual ao de cima",AVATAR_FORMAT:"Infelizmente, suportamos apenas imagens em PGN, GIF ou JPG",AVATAR_SIZE:"Infelizmente, suportamos apenas imagens com tamanho de at\u00e9 1 MB",ADD_AVATAR:"Enviar nova imagem",TOO_WEAK:"Muito fraca",
WEAK:"Fraca",GOOD:"Boa",STRONG:"Forte",DELETE_MODAL_MESSAGE:"Voc\u00ea tem certeza ABSOLUTA?\nSe sim, por favor digite o t\u00edtulo do conto para confirmar.",DELETE_MODAL_WRONG_TITLE:"T\u00edtulo do conto errado"}},p={name:[{type:"length[3]",prompt:l[f].NAME_MIN},{type:"maxLength[50]",prompt:l[f].NAME_MAX}],username:[{type:"length[3]",prompt:l[f].USERNAME_MIN},{type:"maxLength[50]",prompt:l[f].USERNAME_MAX}],email:[{type:"email",prompt:l[f].EMAIL},{type:"maxLength[50]",prompt:l[f].EMAIL_MAX}],password:[{type:"length[6]",
prompt:l[f].PASSWORD_MIN}],biography:[{type:"maxLength[500]",prompt:l[f].BIOGRAPHY_MAX}],title:[{type:"empty",prompt:l[f].EMPTY},{type:"maxLength[500]",prompt:l[f].TITLE_MAX}],description:[{type:"maxLength[500]",prompt:l[f].DESCRIPTION_MAX}],empty:[{type:"empty",prompt:l[f].EMPTY}],checked:[{type:"checked",prompt:l[f].CHECKED}],match:function(a){return[{type:"match["+a+"]",prompt:l[f].MATCH}]}},B=function(a){if(6>a.length)return 0;if(8>a.length)return 1;var m=0;/[a-z]/.test(a)&&++m;/[A-Z]/.test(a)&&
++m;/[0-9]/.test(a)&&++m;/[@#$%&\*\(\)!\-\+]/.test(a)&&++m;return 1==m?1:2==m?2:3},v=function(a,m,C){var b='<ul class="ui negative message" id="messages-list">';C&&(b='<ul class="ui positive message" id="messages-list">');for(C=a.length-1;0<=C;C--)b+="<li>"+a[C]+"</li>";b+="</ul>";$("#messages-list").remove();m.after(b)};$("#language-en, #language-pt").on("click",function(a){a.preventDefault();a=/\-(\w+)/.exec(this.id)[1];$.ajax({type:"get",url:"/set_language",datatype:"json",data:{language:a},success:function(a){window.location.reload(!0)},
error:function(a,b,c){console.log(a)}});return!1});if("/"===q){var A=$("#top-all"),y=$("#top-today"),z=$(".top-tales");A.on("click",function(a){y.removeClass("active");A.addClass("active");$.ajax({type:"get",url:"/get_ten_best_tales",datatype:"json",success:function(a){z.find("div").remove();z.append(a)},error:function(a,b,c){console.log(a)}})});y.on("click",function(a){A.removeClass("active");y.addClass("active");$.ajax({type:"get",url:"/get_ten_best_daily_tales",datatype:"json",success:function(a){z.find("div").remove();
z.append(a)},error:function(a,b,c){console.log(a)}})});y.trigger("click")}if(-1!==q.indexOf("join")){var D=$(".login"),r=$(".signup"),G=r.find(".password-strength");r.find('input[name="signup-password"]').on("keyup",function(a){a=B(this.value);G.removeClass();switch(a){case 0:G.addClass("ui yellow label").html(l[f].TOO_WEAK);break;case 1:G.addClass("ui green label").html(l[f].WEAK);break;case 2:G.addClass("ui blue label").html(l[f].GOOD);break;default:G.addClass("ui red label").html(l[f].STRONG)}});
D.find("form").form({username:{identifier:"login-username",rules:p.username},password:{identifier:"login-password",rules:p.password}},{inline:!0,onSuccess:function(){var a=$(this).find('input[type="password"]')[0],m=(new jsSHA(a.value,"TEXT")).getHash("SHA-256","HEX");a.value=m;$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,m,b){v(a.responseJSON.error_list,D.find("h2"))}});return!1}});r.find("form").form({username:{identifier:"signup-username",
rules:p.username},email:{identifier:"signup-email",rules:p.email},password:{identifier:"signup-password",rules:p.password},repeat_password:{identifier:"signup-repeat-password",rules:p.match("signup-password")}},{inline:!0,onSuccess:function(){var a=$(this).find('input[name="signup-password"]')[0],m=a.value,m=(new jsSHA(m,"TEXT")).getHash("SHA-256","HEX");a.value=m;a=$(this).find('input[name="signup-repeat-password"]')[0];m=a.value;m=(new jsSHA(m,"TEXT")).getHash("SHA-256","HEX");a.value=m;$.ajax({type:this.method,
url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){v([a.message],r.find("h2"),!0)},error:function(a,m,b){v(a.responseJSON.error_list,r.find("h2"))}});return!1}})}if(-1!==q.indexOf("password_reset")){var J=$(".password-reset form");J.form({email:{identifier:"password-reset-email",rules:p.email}},{inline:!0,onSuccess:function(){$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){v([a.message],J.find("h1"),
!0)},error:function(a,m,b){v(a.responseJSON.error_list,J.find("h1"))}});return!1}})}if(-1!==q.indexOf("change_password")){var M=$(".change-password form");M.form({password:{identifier:"change-password-new-password",rules:p.password},repeat_password:{identifier:"change-password-confirm-new-password",rules:p.password}},{inline:!0,onSuccess:function(){var a=$(this).find('input[name="change-password-new-password"]')[0],m=a.value,m=(new jsSHA(m,"TEXT")).getHash("SHA-256","HEX");a.value=m;a=$(this).find('input[name="change-password-confirm-new-password"]')[0];
m=a.value;m=(new jsSHA(m,"TEXT")).getHash("SHA-256","HEX");a.value=m;$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,m,b){v(a.responseJSON.error_list,M.find("h1"))}});return!1}})}if(-1!==q.indexOf("profile")){var N=/profile\/([^\/]+)/.exec(q)[1],E=$(".own"),F=$(".participated"),K=function(a,m,b){$.ajax({type:"get",url:"/get_rendered_own_tales",datatype:"json",data:{username:N,offset:a,search_string:m},
success:function(m){E.empty().append(m);b||E.find("input")[0].focus();E.find("#pagination-buttons button").each(function(){parseInt(this.value,10)===parseInt(a,10)?$(this).addClass("disabled"):$(this).removeClass("disabled")})},error:function(a,m,b){console.log(a)}})},L=function(a,m,b){$.ajax({type:"get",url:"/get_rendered_participated_tales",datatype:"json",data:{username:N,offset:a,search_string:m},success:function(m){F.empty().append(m);b||F.find("input")[0].focus();F.find("#pagination-buttons button").each(function(){parseInt(this.value,
10)===parseInt(a,10)?$(this).addClass("disabled"):$(this).removeClass("disabled")})},error:function(a,m,b){console.log(a)}})};E.on("click",".own-pagination",function(a){a.preventDefault();K(this.value,E.find("input")[0].value);return!1});F.on("click",".participated-pagination",function(a){a.preventDefault();L(this.value,F.find("input")[0].value);return!1});K(0,"",!0);L(0,"",!0);E.on("submit","form",function(a){a.preventDefault();K(0,$(this).find("input")[0].value);return!1});F.on("submit","form",
function(a){a.preventDefault();L(0,$(this).find("input")[0].value);return!1})}var w=$(".profile");if(-1!==q.indexOf("update/")){var t=$(".button-update-profile");w.on("change",'input[name="update-avatar"]',function(a){if(a=this.files[0]){var m=w.find(".button-choose-file"),b=w.find(".label-choose-file");/\.(jpe?g|png|gif)$/i.test(a.name)?1048576>a.size?(m.addClass("green").html(a.name),b.removeClass("ui red label").html("")):(this.value="",this.files=[],m.removeClass("green").html(l[f].ADD_AVATAR),
b.addClass("ui red label").html(l[f].AVATAR_SIZE)):(this.value="",this.files=[],m.removeClass("green").html(l[f].ADD_AVATAR),b.addClass("ui red label").html(l[f].AVATAR_FORMAT))}});w.on("click",".button-choose-file",function(a){a.preventDefault();w.find('input[name="update-avatar"]').trigger("click");return!1});t.on("click",function(a){$.ajax({type:"get",url:"/get_user_info",datatype:"json",data:{user_id:this.value},success:function(a){w.find("form").remove();w.append(a);w.find("form").form({name:{identifier:"update-name",
rules:p.name},email:{identifier:"update-email",rules:p.email},email_visibility:{identifier:"update-email-visibility",rules:p.empty},biography:{identifier:"update-biography",rules:p.biography}},{inline:!0,onSuccess:function(){$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,m,b){v(a.responseJSON.error_list,w.find("h4"))}});return!1},onFailure:function(){return!1}})},error:function(a,b,c){console.log(a)}})});
t.trigger("click");$(".button-update-password").on("click",function(a){$.ajax({type:"get",url:"/get_update_password_form",datatype:"json",data:{user_id:this.value},success:function(a){w.find("form").remove();w.append(a);var b=$(".password-strength");$('input[name="update-new-password"]').on("keyup",function(a){a=B(this.value);b.removeClass();switch(a){case 0:b.addClass("ui yellow label").html(l[f].TOO_WEAK);break;case 1:b.addClass("ui green label").html(l[f].WEAK);break;case 2:b.addClass("ui blue label").html(l[f].GOOD);
break;default:b.addClass("ui red label").html(l[f].STRONG)}});w.find("form").form({old_password:{identifier:"update-old-password",rules:p.password},new_password:{identifier:"update-new-password",rules:p.password},confirm_new_password:{identifier:"update-confirm-new-password",rules:p.match("update-new-password")}},{inline:!0,onSuccess:function(){var a=$(this).find('input[name="update-old-password"]')[0],b=a.value,b=(new jsSHA(b,"TEXT")).getHash("SHA-256","HEX");a.value=b;a=$(this).find('input[name="update-new-password"]')[0];
b=a.value;b=(new jsSHA(b,"TEXT")).getHash("SHA-256","HEX");a.value=b;a=$(this).find('input[name="update-confirm-new-password"]')[0];b=a.value;b=(new jsSHA(b,"TEXT")).getHash("SHA-256","HEX");a.value=b;$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,b,m){v(a.responseJSON.error_list,w.find("h4"))}});return!1},onFailure:function(){return!1}})},error:function(a,b,c){console.log(a)}})})}t=$(".upper-bar");
if(0<t.length){var b=$("#to-fullscreen"),d=$("#fullscreen");t.on("submit",".form-unfollow",function(a){a.preventDefault();var b=$(".form-unfollow"),c=b[0].action;$.ajax({type:"post",url:c,datatype:"json",data:new FormData(this),processData:!1,contentType:!1,success:function(a){b.find("button")[0].innerHTML='<i class="unhide icon"></i>'+l[f].WATCH+" "+a.followers;b.attr("action",c.replace("unfollow","follow"));b.attr("class","form-follow column")},error:function(a,b,m){console.log(a)}});return!1});
t.on("submit",".form-follow",function(a){a.preventDefault();var b=$(".form-follow"),c=b[0].action;$.ajax({type:"post",url:c,datatype:"json",data:new FormData(this),processData:!1,contentType:!1,success:function(a){a.error?window.location=a.error:(b.find("button")[0].innerHTML='<i class="unhide icon"></i>'+l[f].UNWATCH+" "+a.followers,b.attr("action",c.replace("follow","unfollow")),b.attr("class","form-unfollow column"))},error:function(a,b,m){console.log(a)}});return!1});t.on("submit",".form-unstar",
function(a){a.preventDefault();var b=$(".form-unstar"),c=b[0].action;$.ajax({type:"post",url:c,datatype:"json",data:new FormData(this),processData:!1,contentType:!1,success:function(a){b.find("button")[0].innerHTML='<i class="star icon"></i>'+l[f].STAR+" "+a.stars;b.attr("action",c.replace("unstar","star"));b.attr("class","form-star column")},error:function(a,b,m){console.log(a)}});return!1});t.on("submit",".form-star",function(a){a.preventDefault();var b=$(".form-star"),c=b[0].action;$.ajax({type:"post",
url:c,datatype:"json",data:new FormData(this),processData:!1,contentType:!1,success:function(a){a.error?window.location=a.error:(b.find("button")[0].innerHTML='<i class="star icon"></i>'+l[f].UNSTAR+" "+a.stars,b.attr("action",c.replace("star","unstar")),b.attr("class","form-unstar column"))},error:function(a,b,m){console.log(a)}});return!1});-1!==q.indexOf("/fullscreen")&&d.modal("show");b.on("click",function(a){d.modal("show")})}if(-1!==q.indexOf("update_tale")){var g=$(".main form");g.form({title:{identifier:"update-tale-title",
rules:p.title},description:{identifier:"update-tale-description",rules:p.description},genres:{identifier:"update-tale-genres",rules:[{type:"empty_genres",prompt:l[f].EMPTY}]},license:{identifier:"update-tale-license",rules:p.checked},type:{identifier:"update-tale-type",rules:p.checked}},{rules:{empty_genres:function(){return 0<$('[name="update-tale-genres"]')[0].children.length}},inline:!0,onSuccess:function(){$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,
success:function(a){window.location=a.url},error:function(a,b,c){v(a.responseJSON.error_list,g.find("h1"))}});return!1}});var t=$("#genres"),c=$('select[name="update-tale-genres"]'),e=$('select[name="available-genres"]');$("#available-genres").on("keyup",function(a){a=this.value;for(var b=e[0],c=0;c<b.length;c++)0>b[c].innerHTML.indexOf(a)?$(b[c]).attr("hidden","true"):$(b[c]).removeAttr("hidden")});$("#taken-genres").on("keyup",function(a){a=this.value;for(var b=c[0],e=0;e<b.length;e++)0>b[e].innerHTML.indexOf(a)?
$(b[e]).attr("hidden","true"):$(b[e]).removeAttr("hidden")});$("#add").on("click",function(a){a=e.find("option:selected");for(var b=0;b<a.length;b++)c.append(a[b])});$("#remove").on("click",function(a){a=c.find("option:selected");for(var b=0;b<a.length;b++)e.append(a[b])});t.on("dblclick",'select[name="update-tale-genres"] option',function(a){e.append(this);c.find("option").each(function(){$(this).attr("selected","selected")})});t.on("dblclick",'select[name="available-genres"] option',function(a){c.append(this)})}$(".results");
if(-1!==q.indexOf("search")){$("#layout-search-bar").empty();$('input[name="content"]').focus();var n=$(".main-block"),k=1;$.ajax({type:"get",url:"/search_tales"+window.location.search,datatype:"json",success:function(a){n.empty().append(a)},error:function(a,b,c){console.log(a)}});var R=function(a,b){$.ajax({type:"get",url:a,datatype:"json",data:{"sort-value":b},success:function(b){n.empty().append(b);k=a.indexOf("tales")},error:function(a,b,c){console.log(a)}})};$(".search-block").on("click",".search-tales, .search-users",
function(a){a.preventDefault();R(this.href,1);return!1});n.on("change","#sort-bar",function(a){a="";a=0<=k?$(".search-tales")[0].href:$(".search-users")[0].href;R(a,$(this).find("option:selected")[0].value)})}var I=$(".contribution-requests");if(-1!==q.indexOf("contribution_requests")){var S=/contribution_requests\/([0-9]+)/.exec(window.location)[1],O=$(".o-c-r"),Q=$(".c-c-r");O.on("click",function(a){1!==I.find(".open-contribution-requests").length&&(console.log("HERE"),O.addClass("active"),Q.removeClass("active"),
$.ajax({type:"get",url:"/get_open_contribution_requests",datatype:"json",data:{tale_id:S},success:function(a){I.find(".closed-contribution-requests").remove();I.append(a)},error:function(a,b,c){console.log(a)}}))});O.trigger("click");Q.on("click",function(a){1!==I.find(".closed-contribution-requests").length&&(Q.addClass("active"),O.removeClass("active"),$.ajax({type:"get",url:"/get_closed_contribution_requests",datatype:"json",data:{tale_id:S},success:function(a){I.find(".open-contribution-requests").remove();
I.append(a)},error:function(a,b,c){console.log(a)}}))})}if(-1!==q.indexOf("create")){var h=$(".create form");h.form({title:{identifier:"create-title",rules:p.title},description:{identifier:"create-description",rules:p.description},genres:{identifier:"create-genres",rules:[{type:"empty_genres",prompt:l[f].EMPTY}]},license:{identifier:"create-license",rules:p.checked},type:{identifier:"create-type",rules:p.checked}},{rules:{empty_genres:function(){return 0<$('[name="create-genres"]')[0].children.length}},
inline:!0,onSuccess:function(){$.ajax({type:this.method,url:this.action,data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,b,c){v(a.responseJSON.error_list,h.find("h1"))}});return!1}});var t=$("#genres"),u=$('select[name="create-genres"]'),e=$('select[name="available-genres"]');$("#available-genres").on("keyup",function(a){a=this.value;for(var b=e[0],c=0;c<b.length;c++)0>b[c].innerHTML.indexOf(a)?$(b[c]).attr("hidden","true"):$(b[c]).removeAttr("hidden")});
$("#taken-genres").on("keyup",function(a){a=this.value;for(var b=u[0],c=0;c<b.length;c++)0>b[c].innerHTML.indexOf(a)?$(b[c]).attr("hidden","true"):$(b[c]).removeAttr("hidden")});$("#add").on("click",function(a){a=e.find("option:selected");for(var b=0;b<a.length;b++)u.append(a[b])});$("#remove").on("click",function(a){a=u.find("option:selected");for(var b=0;b<a.length;b++)e.append(a[b])});t.on("dblclick",'select[name="create-genres"] option',function(a){e.append(this);u.find("option").each(function(){$(this).attr("selected",
"selected")})});t.on("dblclick",'select[name="available-genres"] option',function(a){u.append(this)})}if(-1!==q.indexOf("contribute")){var P=$(".contribute-form");tinymce.init({selector:'textarea[name="contribute-content"]'});P.form({title:{identifier:"contribute-title",rules:p.title}},{inline:!0,onSuccess:function(){$.ajax({type:this.method,url:this.action,data:{"contribute-title":P.find('[name="contribute-title"]')[0].value,"contribute-content":tinymce.get("contribute-content").getContent(),_csrf_token:P.find('[name="_csrf_token"]')[0].value},
success:function(a){window.location=a.url},error:function(a,b,c){v(a.responseJSON.error_list,P.find("h1"))}});return!1}})}if(-1!==q.indexOf("settings"))$("#form-delete").on("submit",function(a){a.preventDefault();a=$(this).find("button")[0].value;var b=prompt(l[f].DELETE_MODAL_MESSAGE);b&&(b===a?$.ajax({type:this.method,url:this.action,datatype:"json",data:new FormData(this),processData:!1,contentType:!1,success:function(a){window.location=a.url},error:function(a,b,c){console.log(a)}}):($(this).find("div").remove(),
$(this).append('<div class="ui red message">'+l[f].DELETE_MODAL_WRONG_TITLE+"</div>")));return!1})});"use strict";
(function(f){function q(b,d,g){var c=0,e=[0],n="",k=null,n=g||"UTF8";if("UTF8"!==n&&"UTF16BE"!==n&&"UTF16LE"!==n)throw"encoding must be UTF8, UTF16BE, or UTF16LE";if("HEX"===d){if(0!==b.length%2)throw"srcString of HEX type must be in byte increments";k=p(b);c=k.binLen;e=k.value}else if("TEXT"===d)k=l(b,n),c=k.binLen,e=k.value;else if("B64"===d)k=v(b),c=k.binLen,e=k.value;else if("BYTES"===d)k=B(b),c=k.binLen,e=k.value;else throw"inputFormat must be HEX, TEXT, B64, or BYTES";this.getHash=function(b,
d,g,n){var k=null,h=e.slice(),l=c,f;3===arguments.length?"number"!==typeof g&&(n=g,g=1):2===arguments.length&&(g=1);if(g!==parseInt(g,10)||1>g)throw"numRounds must a integer >= 1";switch(d){case "HEX":k=A;break;case "B64":k=y;break;case "BYTES":k=z;break;default:throw"format must be HEX, B64, or BYTES";}if("SHA-224"===b)for(f=0;f<g;f+=1)h=t(h,l,b),l=224;else if("SHA-256"===b)for(f=0;f<g;f+=1)h=t(h,l,b),l=256;else throw"Chosen SHA variant is not supported";return k(h,D(n))};this.getHMAC=function(b,
d,g,k,f){var h,u,q,a,m=[],r=[];switch(k){case "HEX":k=A;break;case "B64":k=y;break;case "BYTES":k=z;break;default:throw"outputFormat must be HEX, B64, or BYTES";}if("SHA-224"===g)u=64,a=224;else if("SHA-256"===g)u=64,a=256;else throw"Chosen SHA variant is not supported";if("HEX"===d)h=p(b),q=h.binLen,h=h.value;else if("TEXT"===d)h=l(b,n),q=h.binLen,h=h.value;else if("B64"===d)h=v(b),q=h.binLen,h=h.value;else if("BYTES"===d)h=B(b),q=h.binLen,h=h.value;else throw"inputFormat must be HEX, TEXT, B64, or BYTES";
b=8*u;d=u/4-1;if(u<q/8){for(h=t(h,q,g);h.length<=d;)h.push(0);h[d]&=4294967040}else if(u>q/8){for(;h.length<=d;)h.push(0);h[d]&=4294967040}for(u=0;u<=d;u+=1)m[u]=h[u]^909522486,r[u]=h[u]^1549556828;g=t(r.concat(t(m.concat(e),b+c,g)),b+a,g);return k(g,D(f))}}function l(b,d){var g=[],c,e=[],n=0,k,f,l;if("UTF8"===d)for(k=0;k<b.length;k+=1)for(c=b.charCodeAt(k),e=[],128>c?e.push(c):2048>c?(e.push(192|c>>>6),e.push(128|c&63)):55296>c||57344<=c?e.push(224|c>>>12,128|c>>>6&63,128|c&63):(k+=1,c=65536+((c&
1023)<<10|b.charCodeAt(k)&1023),e.push(240|c>>>18,128|c>>>12&63,128|c>>>6&63,128|c&63)),f=0;f<e.length;f+=1){for(l=n>>>2;g.length<=l;)g.push(0);g[l]|=e[f]<<24-n%4*8;n+=1}else if("UTF16BE"===d||"UTF16LE"===d)for(k=0;k<b.length;k+=1){c=b.charCodeAt(k);"UTF16LE"===d&&(f=c&255,c=f<<8|c>>8);for(l=n>>>2;g.length<=l;)g.push(0);g[l]|=c<<16-n%4*8;n+=2}return{value:g,binLen:8*n}}function p(b){var d=[],g=b.length,c,e,n;if(0!==g%2)throw"String of HEX type must be in byte increments";for(c=0;c<g;c+=2){e=parseInt(b.substr(c,
2),16);if(isNaN(e))throw"String of HEX type contains invalid characters";for(n=c>>>3;d.length<=n;)d.push(0);d[c>>>3]|=e<<24-c%8*4}return{value:d,binLen:4*g}}function B(b){var d=[],g,c,e;for(c=0;c<b.length;c+=1)g=b.charCodeAt(c),e=c>>>2,d.length<=e&&d.push(0),d[e]|=g<<24-c%4*8;return{value:d,binLen:8*b.length}}function v(b){var d=[],g=0,c,e,n,k,f;if(-1===b.search(/^[a-zA-Z0-9=+\/]+$/))throw"Invalid character in base-64 string";e=b.indexOf("=");b=b.replace(/\=/g,"");if(-1!==e&&e<b.length)throw"Invalid '=' found in base-64 string";
for(e=0;e<b.length;e+=4){f=b.substr(e,4);for(n=k=0;n<f.length;n+=1)c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(f[n]),k|=c<<18-6*n;for(n=0;n<f.length-1;n+=1){for(c=g>>>2;d.length<=c;)d.push(0);d[c]|=(k>>>16-8*n&255)<<24-g%4*8;g+=1}}return{value:d,binLen:8*g}}function A(b,d){var g="",c=4*b.length,e,f;for(e=0;e<c;e+=1)f=b[e>>>2]>>>8*(3-e%4),g+="0123456789abcdef".charAt(f>>>4&15)+"0123456789abcdef".charAt(f&15);return d.outputUpper?g.toUpperCase():g}function y(b,d){var g=
"",c=4*b.length,e,f,k;for(e=0;e<c;e+=3)for(k=e+1>>>2,f=b.length<=k?0:b[k],k=e+2>>>2,k=b.length<=k?0:b[k],k=(b[e>>>2]>>>8*(3-e%4)&255)<<16|(f>>>8*(3-(e+1)%4)&255)<<8|k>>>8*(3-(e+2)%4)&255,f=0;4>f;f+=1)g=8*e+6*f<=32*b.length?g+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>6*(3-f)&63):g+d.b64Pad;return g}function z(b){var d="",g=4*b.length,c,e;for(c=0;c<g;c+=1)e=b[c>>>2]>>>8*(3-c%4)&255,d+=String.fromCharCode(e);return d}function D(b){var d={outputUpper:!1,b64Pad:"="};
try{b.hasOwnProperty("outputUpper")&&(d.outputUpper=b.outputUpper),b.hasOwnProperty("b64Pad")&&(d.b64Pad=b.b64Pad)}catch(g){}if("boolean"!==typeof d.outputUpper)throw"Invalid outputUpper formatting option";if("string"!==typeof d.b64Pad)throw"Invalid b64Pad formatting option";return d}function r(b,d){return b>>>d|b<<32-d}function G(b,d,g){return b&d^~b&g}function J(b,d,g){return b&d^b&g^d&g}function M(b){return r(b,2)^r(b,13)^r(b,22)}function N(b){return r(b,6)^r(b,11)^r(b,25)}function E(b){return r(b,
7)^r(b,18)^b>>>3}function F(b){return r(b,17)^r(b,19)^b>>>10}function K(b,d){var g=(b&65535)+(d&65535);return((b>>>16)+(d>>>16)+(g>>>16)&65535)<<16|g&65535}function L(b,d,g,c){var e=(b&65535)+(d&65535)+(g&65535)+(c&65535);return((b>>>16)+(d>>>16)+(g>>>16)+(c>>>16)+(e>>>16)&65535)<<16|e&65535}function w(b,d,g,c,e){var f=(b&65535)+(d&65535)+(g&65535)+(c&65535)+(e&65535);return((b>>>16)+(d>>>16)+(g>>>16)+(c>>>16)+(e>>>16)+(f>>>16)&65535)<<16|f&65535}function t(b,d,g){var c,e,f,k,l,p,q,t,r,h,u,v,a,m,
C,x,y,z,A,B,D,T,U,V,W,H=[],X,Y=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,
3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428];e=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];if("SHA-224"===g||"SHA-256"===g)u=64,c=(d+65>>>9<<4)+15,m=16,C=1,W=Number,x=K,y=L,z=w,A=E,B=F,D=M,T=N,V=J,
U=G,h="SHA-224"===g?h:e;else throw"Unexpected error in SHA-2 implementation";for(;b.length<=c;)b.push(0);b[d>>>5]|=128<<24-d%32;b[c]=d;X=b.length;for(v=0;v<X;v+=m){d=h[0];c=h[1];e=h[2];f=h[3];k=h[4];l=h[5];p=h[6];q=h[7];for(a=0;a<u;a+=1)16>a?(r=a*C+v,t=b.length<=r?0:b[r],r=b.length<=r+1?0:b[r+1],H[a]=new W(t,r)):H[a]=y(B(H[a-2]),H[a-7],A(H[a-15]),H[a-16]),t=z(q,T(k),U(k,l,p),Y[a],H[a]),r=x(D(d),V(d,c,e)),q=p,p=l,l=k,k=x(f,t),f=e,e=c,c=d,d=x(t,r);h[0]=x(d,h[0]);h[1]=x(c,h[1]);h[2]=x(e,h[2]);h[3]=x(f,
h[3]);h[4]=x(k,h[4]);h[5]=x(l,h[5]);h[6]=x(p,h[6]);h[7]=x(q,h[7])}if("SHA-224"===g)b=[h[0],h[1],h[2],h[3],h[4],h[5],h[6]];else if("SHA-256"===g)b=h;else throw"Unexpected error in SHA-2 implementation";return b}"function"===typeof define&&define.amd?define(function(){return q}):"undefined"!==typeof exports?"undefined"!==typeof module&&module.exports?module.exports=exports=q:exports=q:f.jsSHA=q})(this);